import{_ as ce,u as pe,r as m,m as T,c as ve,I as fe,o as me,a as ge,b as k,h as n,d as o,x as F,s as q,w as l,e as p,f as w,E as d,g as f,i,j as v,q as _e,k as A,J as D,y as B,t as $,F as ye,z as Ve,D as he}from"./index-BzEWj0-9.js";const Ue={class:"coach-profile-container"},we={class:"back-button-container"},be={class:"profile-title"},ke={class:"profile-nav"},Ie={class:"card-title"},Ce={class:"form-actions"},Fe={class:"card-title"},De={class:"videos-header"},$e={key:2,class:"selected-file-info"},Re={class:"dialog-footer"},xe={key:0,class:"loading-container"},Le={key:1,class:"empty-container"},ze={key:2,class:"videos-list"},Me={class:"video-header"},qe={class:"video-title"},Ae={class:"video-content"},Be={class:"video-preview"},Se={class:"video-info"},Ne={class:"video-url"},Pe={__name:"CoachProfile",setup(je){const S=ge(),I=pe(),y=m("profile"),R=m(null),u=T({coachId:"",username:"",name:"",contact:"",specialty:"",intro:""}),W={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],contact:[{required:!0,message:"请输入联系方式",trigger:"blur"}]},V=m([]),x=m(!1),L=m(!1),z=m(!1),U=m(!1),h=m("url"),C=m([]),J=ve(()=>Array.isArray(V.value)?V.value.filter(t=>t&&t.videoId):[]),N=m(null),s=T({title:"",description:"",videoUrl:"",videoFile:null}),G={title:[{required:!0,message:"请输入视频标题",trigger:"blur"}]},P=async()=>{try{const t=I.currentUser;if(t){const r=(await w.get(`/coaches/${t.coachId}`)).data;Object.assign(u,r)}}catch(t){console.error("获取教练信息失败:",t),d.error("获取教练信息失败")}},M=async()=>{try{x.value=!0;const t=I.currentUser;if(console.log("=== 获取教练视频列表 ==="),console.log("当前教练信息:",t),!t){console.error("获取视频列表失败: 教练信息为空"),d.error("获取视频列表失败: 教练信息为空"),V.value=[];return}const e=t.coachId||t.userId||t.id;console.log("使用的教练ID:",e);const r=await w.get(`/trainer/videos/coach/${e}`);console.log("=== 获取视频列表成功 ==="),console.log("响应状态:",r.status),console.log("响应数据:",r.data),V.value=Array.isArray(r.data)?r.data:[]}catch(t){console.error("=== 获取视频列表失败 ==="),console.error("错误类型:",typeof t),console.error("错误对象:",t),t.response?(console.error("响应状态:",t.response.status),console.error("响应数据:",t.response.data),d.error(`获取视频列表失败: ${t.response.status} - ${t.response.data}`)):t.request?(console.error("请求已发送但未收到响应:",t.request),d.error("获取视频列表失败: 网络连接问题")):(console.error("请求配置错误:",t.message),d.error(`获取视频列表失败: ${t.message}`)),V.value=[]}finally{x.value=!1,console.log("=== 获取视频列表流程结束 ===")}},H=async()=>{if(!R.value)return;if(!await R.value.validate()){d.warning("请填写完整的个人信息");return}try{L.value=!0;const e=await w.put(`/coaches/${u.coachId}`,u);I.setCurrentUser(e.data),d.success("个人信息更新成功")}catch(e){console.error("更新个人信息失败:",e),d.error("更新个人信息失败")}finally{L.value=!1}},K=()=>{h.value==="url"?(s.videoFile=null,C.value=[]):s.videoUrl=""},Q=t=>{s.videoFile=t.raw,C.value=[t]},X=async()=>{if(N.value){if(!s.title){d.warning("请输入视频标题");return}if(h.value==="url"&&!s.videoUrl){d.warning("请输入视频URL");return}else if(h.value==="file"&&!s.videoFile){d.warning("请选择视频文件");return}try{z.value=!0;const t=I.currentUser;if(!t)return;if(h.value==="url"){const e={title:s.title,description:s.description,videoUrl:s.videoUrl,coachId:t.coachId};await w.post("/trainer/videos",e)}else{const e=new FormData;e.append("title",String(s.title)),e.append("description",String(s.description)),e.append("coachId",String(t.coachId)),e.append("videoFile",s.videoFile),console.log("=== 准备发送文件上传请求 ==="),console.log("title:",s.title),console.log("description:",s.description),console.log("coachId:",t.coachId),console.log("videoFile:",s.videoFile),console.log("formData has title:",e.has("title")),console.log("formData has description:",e.has("description")),console.log("formData has coachId:",e.has("coachId")),console.log("formData has videoFile:",e.has("videoFile")),await w.post("/trainer/videos/upload",e),console.log("=== 文件上传请求发送成功 ===")}d.success("视频上传成功"),U.value=!1,Object.assign(s,{title:"",description:"",videoUrl:"",videoFile:null}),C.value=[],h.value="url",M()}catch(t){console.error("上传视频失败:",t),d.error("上传视频失败")}finally{z.value=!1}}},Y=async t=>{try{await w.delete(`/trainer/videos/${t}`),d.success("视频删除成功"),V.value=V.value.filter(e=>e.videoId!==t)}catch(e){console.error("删除视频失败:",e),d.error("删除视频失败")}},Z=async t=>{try{const r=(await w.get(`/trainer/videos/${t}`)).data;if(r&&r.videoUrl){const c=r.videoUrl,b=c.startsWith("http")?new URL(c).pathname:c;window.open(b,"_blank")}else d.error("视频URL无效")}catch(e){console.error("获取视频信息失败:",e),d.error("获取视频信息失败")}},ee=()=>{Object.assign(s,{title:"",description:"",videoUrl:""}),U.value=!1},oe=()=>{P()},le=t=>t?new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",te=()=>{S.push("/coach/dashboard")};return fe(y,t=>{t==="videos"&&M()}),me(()=>{if(!I.isAuthenticated){S.push("/coach/login");return}P(),y.value==="videos"&&M()}),(t,e)=>{const r=p("el-icon"),c=p("el-button"),b=p("el-card"),g=p("el-input"),_=p("el-form-item"),j=p("el-col"),ae=p("el-row"),E=p("el-form"),O=p("el-radio"),se=p("el-radio-group"),re=p("el-upload"),ne=p("el-dialog"),ie=p("el-skeleton"),de=p("el-empty");return f(),k("div",Ue,[n("div",we,[o(c,{onClick:te},{default:l(()=>[o(r,null,{default:l(()=>[o(v(_e))]),_:1}),e[17]||(e[17]=i(" 返回控制台 ",-1))]),_:1})]),o(b,{class:"profile-header-card",shadow:"hover"},{header:l(()=>[n("div",be,[o(r,null,{default:l(()=>[o(v(A))]),_:1}),e[18]||(e[18]=i(" 我的个人中心 ",-1))])]),default:l(()=>[n("div",ke,[o(c,{type:y.value==="profile"?"primary":"",onClick:e[0]||(e[0]=a=>y.value="profile"),size:"large"},{default:l(()=>[o(r,null,{default:l(()=>[o(v(A))]),_:1}),e[19]||(e[19]=i(" 个人信息 ",-1))]),_:1},8,["type"]),o(c,{type:y.value==="videos"?"primary":"",onClick:e[1]||(e[1]=a=>y.value="videos"),size:"large"},{default:l(()=>[o(r,null,{default:l(()=>[o(v(D))]),_:1}),e[20]||(e[20]=i(" 教学视频 ",-1))]),_:1},8,["type"])])]),_:1}),y.value==="profile"?(f(),F(b,{key:0,class:"profile-card",shadow:"hover"},{header:l(()=>[n("div",Ie,[o(r,null,{default:l(()=>[o(v(A))]),_:1}),e[21]||(e[21]=i(" 个人信息 ",-1))])]),default:l(()=>[o(E,{model:u,rules:W,ref_key:"coachFormRef",ref:R,"label-width":"100px"},{default:l(()=>[o(ae,{gutter:20},{default:l(()=>[o(j,{span:12},{default:l(()=>[o(_,{label:"教练ID",prop:"coachId"},{default:l(()=>[o(g,{modelValue:u.coachId,"onUpdate:modelValue":e[2]||(e[2]=a=>u.coachId=a),disabled:"",placeholder:"教练ID"},null,8,["modelValue"])]),_:1}),o(_,{label:"用户名",prop:"username"},{default:l(()=>[o(g,{modelValue:u.username,"onUpdate:modelValue":e[3]||(e[3]=a=>u.username=a),disabled:"",placeholder:"用户名"},null,8,["modelValue"])]),_:1}),o(_,{label:"姓名",prop:"name"},{default:l(()=>[o(g,{modelValue:u.name,"onUpdate:modelValue":e[4]||(e[4]=a=>u.name=a),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),o(_,{label:"联系方式",prop:"contact"},{default:l(()=>[o(g,{modelValue:u.contact,"onUpdate:modelValue":e[5]||(e[5]=a=>u.contact=a),placeholder:"请输入联系方式"},null,8,["modelValue"])]),_:1})]),_:1}),o(j,{span:12},{default:l(()=>[o(_,{label:"专业领域",prop:"specialty"},{default:l(()=>[o(g,{modelValue:u.specialty,"onUpdate:modelValue":e[6]||(e[6]=a=>u.specialty=a),placeholder:"请输入专业领域"},null,8,["modelValue"])]),_:1}),o(_,{label:"简介",prop:"intro"},{default:l(()=>[o(g,{modelValue:u.intro,"onUpdate:modelValue":e[7]||(e[7]=a=>u.intro=a),type:"textarea",rows:3,placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),n("div",Ce,[o(c,{onClick:oe},{default:l(()=>[...e[22]||(e[22]=[i("重置",-1)])]),_:1}),o(c,{type:"primary",onClick:H,loading:L.value},{default:l(()=>[...e[23]||(e[23]=[i(" 保存修改 ",-1)])]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1})):q("",!0),y.value==="videos"?(f(),F(b,{key:1,class:"videos-card",shadow:"hover"},{header:l(()=>[n("div",Fe,[o(r,null,{default:l(()=>[o(v(D))]),_:1}),e[24]||(e[24]=i(" 我的教学视频 ",-1))])]),default:l(()=>[n("div",De,[e[26]||(e[26]=n("h3",null,"视频列表",-1)),o(c,{type:"primary",onClick:e[8]||(e[8]=a=>U.value=!0)},{default:l(()=>[o(r,null,{default:l(()=>[o(v(B))]),_:1}),e[25]||(e[25]=i(" 上传新视频 ",-1))]),_:1})]),o(ne,{modelValue:U.value,"onUpdate:modelValue":e[15]||(e[15]=a=>U.value=a),title:"上传教学视频",width:"600px","before-close":ee},{footer:l(()=>[n("div",Re,[o(c,{onClick:e[14]||(e[14]=a=>U.value=!1)},{default:l(()=>[...e[31]||(e[31]=[i("取消",-1)])]),_:1}),o(c,{type:"primary",onClick:X,loading:z.value},{default:l(()=>[...e[32]||(e[32]=[i(" 上传视频 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[o(E,{model:s,rules:G,ref_key:"videoFormRef",ref:N,"label-width":"100px"},{default:l(()=>[o(_,{label:"视频标题",prop:"title"},{default:l(()=>[o(g,{modelValue:s.title,"onUpdate:modelValue":e[9]||(e[9]=a=>s.title=a),placeholder:"请输入视频标题"},null,8,["modelValue"])]),_:1}),o(_,{label:"视频描述",prop:"description"},{default:l(()=>[o(g,{modelValue:s.description,"onUpdate:modelValue":e[10]||(e[10]=a=>s.description=a),type:"textarea",rows:3,placeholder:"请输入视频描述"},null,8,["modelValue"])]),_:1}),o(_,{label:"视频上传",prop:"videoUrl"},{default:l(()=>[o(se,{modelValue:h.value,"onUpdate:modelValue":e[11]||(e[11]=a=>h.value=a),onChange:K},{default:l(()=>[o(O,{label:"url"},{default:l(()=>[...e[27]||(e[27]=[i("视频URL",-1)])]),_:1}),o(O,{label:"file"},{default:l(()=>[...e[28]||(e[28]=[i("本地文件",-1)])]),_:1})]),_:1},8,["modelValue"]),h.value==="url"?(f(),F(g,{key:0,modelValue:s.videoUrl,"onUpdate:modelValue":e[12]||(e[12]=a=>s.videoUrl=a),placeholder:"请输入视频的完整URL地址"},null,8,["modelValue"])):(f(),F(re,{key:1,"file-list":C.value,"onUpdate:fileList":e[13]||(e[13]=a=>C.value=a),class:"upload-demo",action:"","auto-upload":!1,"on-change":Q,accept:"video/*"},{tip:l(()=>[...e[30]||(e[30]=[n("div",{class:"el-upload__tip"}," 支持MP4、WebM等格式，文件大小不超过100MB ",-1)])]),default:l(()=>[o(c,{type:"primary",size:"small"},{default:l(()=>[o(r,null,{default:l(()=>[o(v(B))]),_:1}),e[29]||(e[29]=i(" 选择视频文件 ",-1))]),_:1})]),_:1},8,["file-list"])),s.videoFile?(f(),k("div",$e,[o(r,null,{default:l(()=>[o(v(D))]),_:1}),i(" "+$(s.videoFile.name),1)])):q("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),x.value?(f(),k("div",xe,[o(ie,{rows:5,animated:""})])):V.value.length===0?(f(),k("div",Le,[o(de,{description:"暂无教学视频"}),o(c,{type:"primary",onClick:e[16]||(e[16]=a=>U.value=!0),style:{"margin-top":"20px"}},{default:l(()=>[o(r,null,{default:l(()=>[o(v(B))]),_:1}),e[33]||(e[33]=i(" 上传首个视频 ",-1))]),_:1})])):(f(),k("div",ze,[(f(!0),k(ye,null,Ve(J.value,a=>(f(),F(b,{key:a.videoId,class:"video-card",shadow:"hover"},{header:l(()=>[n("div",Me,[n("span",qe,$(a.title||`视频 ${a.videoId}`),1),o(c,{type:"danger",size:"small",onClick:ue=>Y(a.videoId)},{default:l(()=>[o(r,null,{default:l(()=>[o(v(he))]),_:1}),e[34]||(e[34]=i(" 删除 ",-1))]),_:1},8,["onClick"])])]),default:l(()=>[n("div",Ae,[n("div",Be,[o(r,{class:"video-icon"},{default:l(()=>[o(v(D))]),_:1}),o(c,{type:"primary",size:"small",onClick:ue=>Z(a.videoId)},{default:l(()=>[o(r,null,{default:l(()=>[o(v(D))]),_:1}),e[35]||(e[35]=i(" 查看视频 ",-1))]),_:1},8,["onClick"])]),n("div",Se,[n("p",null,[e[36]||(e[36]=n("strong",null,"视频URL：",-1)),n("span",Ne,$(a.videoUrl),1)]),n("p",null,[e[37]||(e[37]=n("strong",null,"描述：",-1)),i($(a.description||"暂无描述"),1)]),n("p",null,[e[38]||(e[38]=n("strong",null,"上传时间：",-1)),i($(le(a.uploadDate)),1)])])])]),_:2},1024))),128))]))]),_:1})):q("",!0)])}}},Oe=ce(Pe,[["__scopeId","data-v-270b788f"]]);export{Oe as default};

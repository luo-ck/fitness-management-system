import{_ as ye,u as he,I as Ue,r as g,c as N,m as H,J as Ve,o as we,a as ke,f as k,b,h as n,d as o,x as I,s as R,w as l,e as v,E as c,g as f,i as d,j as u,q as be,k as P,K as x,L as Q,M as Ce,y as j,t as L,F as Ie,z as Fe,D as De,N as $e}from"./index-DZFSj2VF.js";const Re={class:"coach-profile-container"},xe={class:"back-button-container"},Le={class:"profile-title"},Me={class:"profile-nav"},ze={class:"message-center-button-wrapper"},Se={class:"card-title"},Ae={class:"form-actions"},qe={class:"card-title"},Be={class:"videos-header"},Ne={key:2,class:"selected-file-info"},Pe={class:"dialog-footer"},je={key:0,class:"loading-container"},Ee={key:1,class:"empty-container"},Oe={key:2,class:"videos-list"},Te={class:"video-header"},We={class:"video-title"},Je={class:"video-content"},Ke={class:"video-preview"},Ge={class:"video-info"},He={class:"video-url"},Qe={class:"card-title"},Xe={key:0},Ye={key:1,class:"empty-container"},Ze={__name:"CoachProfile",setup(eo){const M=ke(),_=he(),D=Ue(),m=g("profile"),X=N(()=>D.unreadCount),E=N(()=>D.hasUnreadMessages),z=g(null),p=H({coachId:"",username:"",name:"",contact:"",specialty:"",intro:""}),Y={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],contact:[{required:!0,message:"请输入联系方式",trigger:"blur"}]},V=g([]),S=g(!1),A=g(!1),q=g(!1),C=g(!1),w=g("url"),$=g([]),Z=N(()=>Array.isArray(V.value)?V.value.filter(t=>t&&t.videoId):[]),O=g(null),r=H({title:"",description:"",videoUrl:"",videoFile:null}),ee={title:[{required:!0,message:"请输入视频标题",trigger:"blur"}]},T=async()=>{try{const t=_.currentUser;if(t){const s=(await k.get(`/coaches/${t.coachId}`)).data;Object.assign(p,s)}}catch(t){console.error("获取教练信息失败:",t),c.error("获取教练信息失败")}},B=async()=>{try{S.value=!0;const t=_.currentUser;if(console.log("=== 获取教练视频列表 ==="),console.log("当前教练信息:",t),!t){console.error("获取视频列表失败: 教练信息为空"),c.error("获取视频列表失败: 教练信息为空"),V.value=[];return}const e=t.coachId||t.userId||t.id;console.log("使用的教练ID:",e);const s=await k.get(`/trainer/videos/coach/${e}`);console.log("=== 获取视频列表成功 ==="),console.log("响应状态:",s.status),console.log("响应数据:",s.data),V.value=Array.isArray(s.data)?s.data:[]}catch(t){console.error("=== 获取视频列表失败 ==="),console.error("错误类型:",typeof t),console.error("错误对象:",t),t.response?(console.error("响应状态:",t.response.status),console.error("响应数据:",t.response.data),c.error(`获取视频列表失败: ${t.response.status} - ${t.response.data}`)):t.request?(console.error("请求已发送但未收到响应:",t.request),c.error("获取视频列表失败: 网络连接问题")):(console.error("请求配置错误:",t.message),c.error(`获取视频列表失败: ${t.message}`)),V.value=[]}finally{S.value=!1,console.log("=== 获取视频列表流程结束 ===")}},oe=async()=>{if(!z.value)return;if(!await z.value.validate()){c.warning("请填写完整的个人信息");return}try{A.value=!0;const e=await k.put(`/coaches/${p.coachId}`,p);_.setCurrentUser(e.data),c.success("个人信息更新成功")}catch(e){console.error("更新个人信息失败:",e),c.error("更新个人信息失败")}finally{A.value=!1}},le=()=>{w.value==="url"?(r.videoFile=null,$.value=[]):r.videoUrl=""},te=t=>{r.videoFile=t.raw,$.value=[t]},ae=async()=>{if(O.value){if(!r.title){c.warning("请输入视频标题");return}if(w.value==="url"&&!r.videoUrl){c.warning("请输入视频URL");return}else if(w.value==="file"&&!r.videoFile){c.warning("请选择视频文件");return}try{q.value=!0;const t=_.currentUser;if(!t)return;if(w.value==="url"){const e={title:r.title,description:r.description,videoUrl:r.videoUrl,coachId:t.coachId};await k.post("/trainer/videos",e)}else{const e=new FormData;e.append("title",String(r.title)),e.append("description",String(r.description)),e.append("coachId",String(t.coachId)),e.append("videoFile",r.videoFile),console.log("=== 准备发送文件上传请求 ==="),console.log("title:",r.title),console.log("description:",r.description),console.log("coachId:",t.coachId),console.log("videoFile:",r.videoFile),console.log("formData has title:",e.has("title")),console.log("formData has description:",e.has("description")),console.log("formData has coachId:",e.has("coachId")),console.log("formData has videoFile:",e.has("videoFile")),await k.post("/trainer/videos/upload",e),console.log("=== 文件上传请求发送成功 ===")}c.success("视频上传成功"),C.value=!1,Object.assign(r,{title:"",description:"",videoUrl:"",videoFile:null}),$.value=[],w.value="url",B()}catch(t){console.error("上传视频失败:",t),c.error("上传视频失败")}finally{q.value=!1}}},se=async t=>{try{await k.delete(`/trainer/videos/${t}`),c.success("视频删除成功"),V.value=V.value.filter(e=>e.videoId!==t)}catch(e){console.error("删除视频失败:",e),c.error("删除视频失败")}},re=async t=>{try{const s=(await k.get(`/trainer/videos/${t}`)).data;if(s&&s.videoUrl){const i=s.videoUrl,F=i.startsWith("http")?new URL(i).pathname:i;window.open(F,"_blank")}else c.error("视频URL无效")}catch(e){console.error("获取视频信息失败:",e),c.error("获取视频信息失败")}},ne=()=>{Object.assign(r,{title:"",description:"",videoUrl:""}),C.value=!1},de=()=>{T()},ie=t=>t?new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",ue=()=>{M.push("/coach/dashboard")},ce=()=>{M.push("/coach/chat")};return Ve(m,t=>{t==="videos"&&B()}),we(async()=>{var t,e;if(!_.isAuthenticated){M.push("/coach/login");return}T(),m.value==="videos"&&B();try{const s=((t=_.currentUser)==null?void 0:t.userId)||((e=_.currentUser)==null?void 0:e.coachId);if(s){const F=(await k.get(`/messages/conversations/${s}`)).data||[];console.log("获取到的对话列表:",F),D.resetAllUnreadCounts(),F.forEach(y=>{y.unreadCount>0&&D.setConversationUnreadCount(y.otherId,y.unreadCount)}),console.log("初始化后的全局未读消息计数:",D.unreadCount)}}catch(s){console.error("获取对话列表失败:",s)}}),(t,e)=>{const s=v("el-icon"),i=v("el-button"),F=v("el-badge"),y=v("el-card"),h=v("el-input"),U=v("el-form-item"),W=v("el-col"),pe=v("el-row"),J=v("el-form"),K=v("el-radio"),ve=v("el-radio-group"),fe=v("el-upload"),me=v("el-dialog"),ge=v("el-skeleton"),G=v("el-empty");return f(),b("div",Re,[n("div",xe,[o(i,{onClick:ue},{default:l(()=>[o(s,null,{default:l(()=>[o(u(be))]),_:1}),e[18]||(e[18]=d(" 返回控制台 ",-1))]),_:1})]),o(y,{class:"profile-header-card",shadow:"hover"},{header:l(()=>[n("div",Le,[o(s,null,{default:l(()=>[o(u(P))]),_:1}),e[19]||(e[19]=d(" 我的个人中心 ",-1))])]),default:l(()=>[n("div",Me,[o(i,{type:m.value==="profile"?"primary":"",onClick:e[0]||(e[0]=a=>m.value="profile"),size:"large"},{default:l(()=>[o(s,null,{default:l(()=>[o(u(P))]),_:1}),e[20]||(e[20]=d(" 个人信息 ",-1))]),_:1},8,["type"]),o(i,{type:m.value==="videos"?"primary":"",onClick:e[1]||(e[1]=a=>m.value="videos"),size:"large"},{default:l(()=>[o(s,null,{default:l(()=>[o(u(x))]),_:1}),e[21]||(e[21]=d(" 教学视频 ",-1))]),_:1},8,["type"]),o(i,{type:m.value==="ratings"?"primary":"",onClick:e[2]||(e[2]=a=>m.value="ratings"),size:"large"},{default:l(()=>[o(s,null,{default:l(()=>[o(u(Q))]),_:1}),e[22]||(e[22]=d(" 我的评价 ",-1))]),_:1},8,["type"]),n("div",ze,[o(i,{type:"primary",onClick:ce,size:"large",class:"message-center-button"},{default:l(()=>[o(s,null,{default:l(()=>[o(u(Ce))]),_:1}),e[23]||(e[23]=d(" 消息中心 ",-1))]),_:1}),E.value?(f(),I(F,{key:0,value:X.value,type:"danger",class:"message-badge",hidden:!E.value},null,8,["value","hidden"])):R("",!0)])])]),_:1}),m.value==="profile"?(f(),I(y,{key:0,class:"profile-card",shadow:"hover"},{header:l(()=>[n("div",Se,[o(s,null,{default:l(()=>[o(u(P))]),_:1}),e[24]||(e[24]=d(" 个人信息 ",-1))])]),default:l(()=>[o(J,{model:p,rules:Y,ref_key:"coachFormRef",ref:z,"label-width":"100px"},{default:l(()=>[o(pe,{gutter:20},{default:l(()=>[o(W,{span:12},{default:l(()=>[o(U,{label:"教练ID",prop:"coachId"},{default:l(()=>[o(h,{modelValue:p.coachId,"onUpdate:modelValue":e[3]||(e[3]=a=>p.coachId=a),disabled:"",placeholder:"教练ID"},null,8,["modelValue"])]),_:1}),o(U,{label:"用户名",prop:"username"},{default:l(()=>[o(h,{modelValue:p.username,"onUpdate:modelValue":e[4]||(e[4]=a=>p.username=a),disabled:"",placeholder:"用户名"},null,8,["modelValue"])]),_:1}),o(U,{label:"姓名",prop:"name"},{default:l(()=>[o(h,{modelValue:p.name,"onUpdate:modelValue":e[5]||(e[5]=a=>p.name=a),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),o(U,{label:"联系方式",prop:"contact"},{default:l(()=>[o(h,{modelValue:p.contact,"onUpdate:modelValue":e[6]||(e[6]=a=>p.contact=a),placeholder:"请输入联系方式"},null,8,["modelValue"])]),_:1})]),_:1}),o(W,{span:12},{default:l(()=>[o(U,{label:"专业领域",prop:"specialty"},{default:l(()=>[o(h,{modelValue:p.specialty,"onUpdate:modelValue":e[7]||(e[7]=a=>p.specialty=a),placeholder:"请输入专业领域"},null,8,["modelValue"])]),_:1}),o(U,{label:"简介",prop:"intro"},{default:l(()=>[o(h,{modelValue:p.intro,"onUpdate:modelValue":e[8]||(e[8]=a=>p.intro=a),type:"textarea",rows:3,placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),n("div",Ae,[o(i,{onClick:de},{default:l(()=>[...e[25]||(e[25]=[d("重置",-1)])]),_:1}),o(i,{type:"primary",onClick:oe,loading:A.value},{default:l(()=>[...e[26]||(e[26]=[d(" 保存修改 ",-1)])]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1})):R("",!0),m.value==="videos"?(f(),I(y,{key:1,class:"videos-card",shadow:"hover"},{header:l(()=>[n("div",qe,[o(s,null,{default:l(()=>[o(u(x))]),_:1}),e[27]||(e[27]=d(" 我的教学视频 ",-1))])]),default:l(()=>[n("div",Be,[e[29]||(e[29]=n("h3",null,"视频列表",-1)),o(i,{type:"primary",onClick:e[9]||(e[9]=a=>C.value=!0)},{default:l(()=>[o(s,null,{default:l(()=>[o(u(j))]),_:1}),e[28]||(e[28]=d(" 上传新视频 ",-1))]),_:1})]),o(me,{modelValue:C.value,"onUpdate:modelValue":e[16]||(e[16]=a=>C.value=a),title:"上传教学视频",width:"600px","before-close":ne},{footer:l(()=>[n("div",Pe,[o(i,{onClick:e[15]||(e[15]=a=>C.value=!1)},{default:l(()=>[...e[34]||(e[34]=[d("取消",-1)])]),_:1}),o(i,{type:"primary",onClick:ae,loading:q.value},{default:l(()=>[...e[35]||(e[35]=[d(" 上传视频 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[o(J,{model:r,rules:ee,ref_key:"videoFormRef",ref:O,"label-width":"100px"},{default:l(()=>[o(U,{label:"视频标题",prop:"title"},{default:l(()=>[o(h,{modelValue:r.title,"onUpdate:modelValue":e[10]||(e[10]=a=>r.title=a),placeholder:"请输入视频标题"},null,8,["modelValue"])]),_:1}),o(U,{label:"视频描述",prop:"description"},{default:l(()=>[o(h,{modelValue:r.description,"onUpdate:modelValue":e[11]||(e[11]=a=>r.description=a),type:"textarea",rows:3,placeholder:"请输入视频描述"},null,8,["modelValue"])]),_:1}),o(U,{label:"视频上传",prop:"videoUrl"},{default:l(()=>[o(ve,{modelValue:w.value,"onUpdate:modelValue":e[12]||(e[12]=a=>w.value=a),onChange:le},{default:l(()=>[o(K,{label:"url"},{default:l(()=>[...e[30]||(e[30]=[d("视频URL",-1)])]),_:1}),o(K,{label:"file"},{default:l(()=>[...e[31]||(e[31]=[d("本地文件",-1)])]),_:1})]),_:1},8,["modelValue"]),w.value==="url"?(f(),I(h,{key:0,modelValue:r.videoUrl,"onUpdate:modelValue":e[13]||(e[13]=a=>r.videoUrl=a),placeholder:"请输入视频的完整URL地址"},null,8,["modelValue"])):(f(),I(fe,{key:1,"file-list":$.value,"onUpdate:fileList":e[14]||(e[14]=a=>$.value=a),class:"upload-demo",action:"","auto-upload":!1,"on-change":te,accept:"video/*"},{tip:l(()=>[...e[33]||(e[33]=[n("div",{class:"el-upload__tip"}," 支持MP4、WebM等格式，文件大小不超过100MB ",-1)])]),default:l(()=>[o(i,{type:"primary",size:"small"},{default:l(()=>[o(s,null,{default:l(()=>[o(u(j))]),_:1}),e[32]||(e[32]=d(" 选择视频文件 ",-1))]),_:1})]),_:1},8,["file-list"])),r.videoFile?(f(),b("div",Ne,[o(s,null,{default:l(()=>[o(u(x))]),_:1}),d(" "+L(r.videoFile.name),1)])):R("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),S.value?(f(),b("div",je,[o(ge,{rows:5,animated:""})])):V.value.length===0?(f(),b("div",Ee,[o(G,{description:"暂无教学视频"}),o(i,{type:"primary",onClick:e[17]||(e[17]=a=>C.value=!0),style:{"margin-top":"20px"}},{default:l(()=>[o(s,null,{default:l(()=>[o(u(j))]),_:1}),e[36]||(e[36]=d(" 上传首个视频 ",-1))]),_:1})])):(f(),b("div",Oe,[(f(!0),b(Ie,null,Fe(Z.value,a=>(f(),I(y,{key:a.videoId,class:"video-card",shadow:"hover"},{header:l(()=>[n("div",Te,[n("span",We,L(a.title||`视频 ${a.videoId}`),1),o(i,{type:"danger",size:"small",onClick:_e=>se(a.videoId)},{default:l(()=>[o(s,null,{default:l(()=>[o(u(De))]),_:1}),e[37]||(e[37]=d(" 删除 ",-1))]),_:1},8,["onClick"])])]),default:l(()=>[n("div",Je,[n("div",Ke,[o(s,{class:"video-icon"},{default:l(()=>[o(u(x))]),_:1}),o(i,{type:"primary",size:"small",onClick:_e=>re(a.videoId)},{default:l(()=>[o(s,null,{default:l(()=>[o(u(x))]),_:1}),e[38]||(e[38]=d(" 查看视频 ",-1))]),_:1},8,["onClick"])]),n("div",Ge,[n("p",null,[e[39]||(e[39]=n("strong",null,"视频URL：",-1)),n("span",He,L(a.videoUrl),1)]),n("p",null,[e[40]||(e[40]=n("strong",null,"描述：",-1)),d(L(a.description||"暂无描述"),1)]),n("p",null,[e[41]||(e[41]=n("strong",null,"上传时间：",-1)),d(L(ie(a.uploadDate)),1)])])])]),_:2},1024))),128))]))]),_:1})):R("",!0),m.value==="ratings"?(f(),I(y,{key:2,class:"ratings-card",shadow:"hover"},{header:l(()=>[n("div",Qe,[o(s,null,{default:l(()=>[o(u(Q))]),_:1}),e[42]||(e[42]=d(" 我的评价 ",-1))])]),default:l(()=>[u(_).currentUser?(f(),b("div",Xe,[o($e,{"coach-id":u(_).currentUser.coachId},null,8,["coach-id"])])):(f(),b("div",Ye,[o(G,{description:"加载教练信息失败"})]))]),_:1})):R("",!0)])}}},lo=ye(Ze,[["__scopeId","data-v-9ff6e2a9"]]);export{lo as default};

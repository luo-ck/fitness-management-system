import{_ as ee,r as $,m as le,c as M,n as ae,o as oe,b as D,h as m,d as e,w as a,e as d,f as x,E as u,a as te,g as I,i as v,j as k,q as ne,y as z,F as J,z as j,x as H,t as S,D as se,H as re}from"./index-Bh0XRPA7.js";const de={class:"plan-edit-container"},ue={class:"back-button-container"},ce={class:"card-title"},ie={class:"exercises-section"},pe={class:"section-header"},me={key:0,class:"empty-exercises"},_e={key:1,class:"exercises-list"},fe={class:"exercise-header"},ve={class:"exercise-index"},ge={class:"form-actions"},Ie={__name:"CoachTrainingPlanEdit",setup(he){const Y=ae(),L=te(),C=$(null),b=$(!1),h=le({planId:null,planDate:new Date().toISOString().split("T")[0]}),_=$([]),q=$([]),F=M(()=>Y.params.userId),y=M(()=>Y.params.planId),f=M(()=>{const t=y.value;return t!=null&&t!==""&&!isNaN(parseInt(t))&&parseInt(t)>0}),A={planDate:[{required:!0,message:"请选择训练日期",trigger:"change"}]},G={name:[{required:!0,message:"请选择运动名称",trigger:"change"}],sets:[{required:!0,message:"请输入组数",trigger:"blur"}],reps:[{required:!0,message:"请输入次数",trigger:"blur"}]},K=async()=>{try{const t=JSON.parse(localStorage.getItem("user")),o=t?t.coachId||t.userId:null;if(!o){console.error("获取教练ID失败，coachUser:",t);return}console.log("=== 获取教练视频列表 ==="),console.log("教练ID:",o);const l=await x.get(`/trainer/videos/coach/${o}`);console.log("视频列表响应:",l.data),q.value=l.data}catch(t){console.error("获取教练视频列表失败:",t),t.response&&(console.error("响应状态:",t.response.status),console.error("响应数据:",t.response.data))}},R=()=>{_.value.push({name:"",sets:3,reps:10,duration:null,videoId:null})},Q=t=>{_.value.splice(t,1)},W=async()=>{try{if(b.value=!0,!f.value)return;const t=parseInt(y.value,10);if(isNaN(t)||t<=0){u.warning("无效的计划ID"),g();return}const l=(await x.get(`/training-plans/${t}`)).data;if(!l){u.warning("未找到该训练计划"),g();return}if(h.planId=l.planId,h.planDate=l.planDate,l.exercises&&l.exercises.length>0){const i={1:"跑步",2:"游泳",3:"举重",4:"俯卧撑",5:"仰卧起坐",6:"深蹲",7:"引体向上",8:"跳绳",9:"平板卧推"};_.value=l.exercises.map(p=>({name:i[p.exerciseId]||`运动${p.exerciseId}`,sets:p.sets,reps:p.reps,duration:p.duration,videoId:p.videoId||null}))}else _.value=[]}catch(t){if(console.error("获取计划详情失败:",t),t.response){const{status:o,data:l}=t.response;o===404?(u.warning("未找到该训练计划"),g()):o===400?(u.warning("无效的请求参数，请检查计划ID"),g()):(u.error(`获取计划详情失败，状态码: ${o}`),console.error("错误详情:",l))}else u.error("获取计划详情失败，请检查网络连接")}finally{b.value=!1}},X=async()=>{if(!C.value)return;if(!await C.value.validate()){u.warning("请填写完整计划信息");return}let o=!0;for(const l of _.value)if(!l.name||!l.sets||!l.reps){o=!1;break}if(!o){u.warning("请填写完整的运动项信息");return}if(_.value.length===0){u.warning("请至少添加一个运动项");return}try{b.value=!0;const l=JSON.parse(localStorage.getItem("user")),i=l?l.coachId:null,p={...h,userId:F.value,coachId:i};let c,N;const T={跑步:1,游泳:2,举重:3,俯卧撑:4,仰卧起坐:5,深蹲:6,引体向上:7,跳绳:8,平板卧推:9},w={...p,exercises:_.value.map((n,U)=>{const V=T[n.name];if(!V)throw console.error(`运动项 ${n.name} 没有对应的exerciseId映射`),new Error(`运动项 ${n.name} 配置错误`);return{exerciseId:V,sets:n.sets,reps:n.reps,duration:n.duration,orderIndex:U,videoId:n.videoId||null}})};console.log("=== 准备提交训练计划 ==="),console.log("计划ID:",y.value),console.log("是否编辑模式:",f.value),console.log("提交数据:",w),f.value?(console.log("发送PUT请求:",`/training-plans/${y.value}`),c=await x.put(`/training-plans/${y.value}`,w),console.log("PUT请求成功:",c),u.success("训练计划更新成功")):(console.log("发送POST请求:","/training-plans"),c=await x.post("/training-plans",w),console.log("POST请求成功:",c),u.success("训练计划创建成功")),console.log("导航回计划列表"),g()}catch(l){console.error("=== 提交训练计划失败 ==="),console.error("错误类型:",typeof l),console.error("错误对象:",l),l.response?(console.error("响应状态:",l.response.status),console.error("响应数据:",l.response.data),console.error("响应头:",l.response.headers),u.error(`${f.value?"更新":"创建"}失败，状态码: ${l.response.status}`)):l.request?(console.error("请求已发送但未收到响应:",l.request),u.error(`${f.value?"更新":"创建"}失败，未收到服务器响应`)):(console.error("请求配置错误:",l.message),u.error(`${f.value?"更新":"创建"}失败，请求配置错误: ${l.message}`))}finally{b.value=!1,console.log("=== 提交训练计划流程结束 ===")}},g=()=>{L.push(`/coach/student/${F.value}/plans`)};return oe(()=>{K(),f.value&&W()}),(t,o)=>{const l=d("el-icon"),i=d("el-button"),p=d("el-date-picker"),c=d("el-form-item"),N=d("el-form"),T=d("el-divider"),w=d("el-empty"),n=d("el-option"),U=d("el-select"),V=d("el-input-number"),P=d("el-col"),B=d("el-row"),Z=d("el-input"),O=d("el-card");return I(),D("div",de,[m("div",ue,[e(i,{onClick:g},{default:a(()=>[e(l,null,{default:a(()=>[e(k(ne))]),_:1}),o[1]||(o[1]=v(" 返回 ",-1))]),_:1})]),e(O,{class:"plan-edit-card",shadow:"hover"},{header:a(()=>[m("div",ce,[e(l,null,{default:a(()=>[e(k(re))]),_:1}),v(" "+S(f.value?"编辑训练计划":"创建训练计划"),1)])]),default:a(()=>[e(N,{model:h,rules:A,ref_key:"planFormRef",ref:C,"label-width":"100px"},{default:a(()=>[e(c,{label:"训练日期",prop:"planDate"},{default:a(()=>[e(p,{modelValue:h.planDate,"onUpdate:modelValue":o[0]||(o[0]=r=>h.planDate=r),type:"date",placeholder:"选择训练日期",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),e(T,null,{default:a(()=>[...o[2]||(o[2]=[v("运动项目",-1)])]),_:1}),m("div",ie,[m("div",pe,[o[4]||(o[4]=m("h3",null,"运动项列表",-1)),e(i,{type:"primary",onClick:R},{default:a(()=>[e(l,null,{default:a(()=>[e(k(z))]),_:1}),o[3]||(o[3]=v(" 添加运动项 ",-1))]),_:1})]),_.value.length===0?(I(),D("div",me,[e(w,{description:"暂无运动项"}),e(i,{type:"primary",onClick:R,style:{"margin-top":"20px"}},{default:a(()=>[e(l,null,{default:a(()=>[e(k(z))]),_:1}),o[5]||(o[5]=v(" 添加首个运动项 ",-1))]),_:1})])):(I(),D("div",_e,[(I(!0),D(J,null,j(_.value,(r,E)=>(I(),H(O,{key:`exercise-${E}`,class:"exercise-card",shadow:"hover"},{header:a(()=>[m("div",fe,[m("span",ve,"运动项 "+S(E+1),1),e(i,{type:"danger",size:"small",onClick:s=>Q(E)},{default:a(()=>[e(l,null,{default:a(()=>[e(k(se))]),_:1}),o[6]||(o[6]=v(" 删除 ",-1))]),_:1},8,["onClick"])])]),default:a(()=>[e(N,{model:r,rules:G,"label-width":"80px"},{default:a(()=>[e(B,{gutter:20},{default:a(()=>[e(P,{span:12},{default:a(()=>[e(c,{label:"运动名称",prop:"name"},{default:a(()=>[e(U,{modelValue:r.name,"onUpdate:modelValue":s=>r.name=s,placeholder:"选择运动名称"},{default:a(()=>[e(n,{label:"跑步",value:"跑步"}),e(n,{label:"游泳",value:"游泳"}),e(n,{label:"举重",value:"举重"}),e(n,{label:"俯卧撑",value:"俯卧撑"}),e(n,{label:"仰卧起坐",value:"仰卧起坐"}),e(n,{label:"深蹲",value:"深蹲"}),e(n,{label:"引体向上",value:"引体向上"}),e(n,{label:"跳绳",value:"跳绳"}),e(n,{label:"平板卧推",value:"平板卧推"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(c,{label:"组数",prop:"sets"},{default:a(()=>[e(V,{modelValue:r.sets,"onUpdate:modelValue":s=>r.sets=s,min:1,max:20,placeholder:"组数"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),e(P,{span:12},{default:a(()=>[e(c,{label:"次数",prop:"reps"},{default:a(()=>[e(V,{modelValue:r.reps,"onUpdate:modelValue":s=>r.reps=s,min:1,max:100,placeholder:"次数"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(c,{label:"时长(分钟)",prop:"duration"},{default:a(()=>[e(V,{modelValue:r.duration,"onUpdate:modelValue":s=>r.duration=s,min:1,max:120,placeholder:"时长"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(B,null,{default:a(()=>[e(P,{span:24},{default:a(()=>[e(c,{label:"教学视频"},{default:a(()=>[e(U,{modelValue:r.videoId,"onUpdate:modelValue":s=>r.videoId=s,placeholder:"选择教学视频",style:{width:"100%"}},{default:a(()=>[e(n,{label:"无",value:""}),(I(!0),D(J,null,j(q.value,s=>(I(),H(n,{key:s.videoId,label:s.title||`视频 ${s.videoId}`,value:s.videoId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"]),o[7]||(o[7]=m("div",{class:"video-upload-tip"},[m("small",null,"提示：请先上传教学视频，然后在此选择关联的视频")],-1))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(c,{label:"备注"},{default:a(()=>[e(Z,{modelValue:r.notes,"onUpdate:modelValue":s=>r.notes=s,type:"textarea",rows:2,placeholder:"请输入备注信息"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model"])]),_:2},1024))),128))]))]),m("div",ge,[e(i,{onClick:g},{default:a(()=>[...o[8]||(o[8]=[v("返回",-1)])]),_:1}),e(i,{type:"primary",onClick:X,loading:b.value},{default:a(()=>[v(S(f.value?"保存修改":"创建计划"),1)]),_:1},8,["loading"])])]),_:1})])}}},be=ee(Ie,[["__scopeId","data-v-2125a3e2"]]);export{be as default};

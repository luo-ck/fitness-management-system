import{_ as Z,r as i,c as ee,o as te,b,h as n,d as t,w as l,e as r,f as N,E as F,a as ae,g as c,i as u,j as k,L as le,M as se,N as ne,t as v,v as oe,H as $,s as M,x as U}from"./index-Bh0XRPA7.js";const de={class:"admin-feedback-container"},re={class:"back-button-container"},ie={class:"feedback-title"},ue={class:"search-filter"},ce={key:0,class:"loading-container"},pe={key:1,class:"empty-container"},ve={key:2,class:"feedback-list"},fe={class:"pagination-container"},_e={key:0,class:"feedback-detail"},me={class:"detail-item"},be={class:"value"},ke={class:"detail-item"},ge={class:"value"},ye={class:"detail-item"},we={class:"value"},Ce={class:"detail-item"},he={class:"value"},Ie={class:"detail-item detail-content"},Ve={class:"value"},De={key:1,class:"reply-form-container"},Fe={class:"dialog-footer"},ze={__name:"AdminFeedbackManagement",setup(Se){ae();const C=i(!1),y=i(""),w=i(1),h=i(10),I=i([]),f=i(!1),d=i(null),_=i(!1),V=i(null),D=i(!1),g=i({content:""}),B={content:[{required:!0,message:"请输入回复内容",trigger:"blur"}]},z=a=>a?new Date(a).toLocaleString():"",E=(a,e)=>a?a.length<=e?a:a.substring(0,e)+"...":"",S=ee(()=>{let a=[...I.value];if(y.value){const e=y.value.toLowerCase();a=a.filter(s=>s.title.toLowerCase().includes(e)||s.content.toLowerCase().includes(e))}return a=a.filter(e=>e.feedbackType==="opinion"||e.feedbackType===null),a}),L=async()=>{var a,e;C.value=!0;try{const s=await N.get("/feedback");I.value=s.data||[]}catch(s){console.error("获取反馈列表失败:",s),F.error("获取反馈列表失败: "+(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.message)||s.message))}finally{C.value=!1}},T=()=>{w.value=1},j=a=>{h.value=a},A=a=>{w.value=a},P=a=>{d.value=a,_.value=!1,f.value=!0},q=a=>{d.value=a,_.value=!0,f.value=!0,g.value.content=""},H=async()=>{var a,e;if(!(!V.value||!d.value))try{await V.value.validate(),D.value=!0;const s={senderId:1,senderName:"管理员",receiverId:d.value.userId,receiverType:"user",messageType:"feedback_reply",title:"反馈回复",content:g.value.content,relatedId:d.value.feedbackId,isRead:!1,sendTime:new Date().toISOString().slice(0,19).replace("T"," ")};await N.post("/messages",s),F.success("回复发送成功"),f.value=!1,_.value=!1}catch(s){if(s.name==="ValidateError")return;F.error("发送回复失败: "+(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.message)||s.message))}finally{D.value=!1}};return te(()=>{L()}),(a,e)=>{const s=r("el-icon"),p=r("el-button"),R=r("el-input"),x=r("el-card"),K=r("el-skeleton"),O=r("el-empty"),m=r("el-table-column"),G=r("el-table"),J=r("el-pagination"),Q=r("el-form-item"),W=r("el-form"),X=r("el-dialog");return c(),b("div",de,[n("div",re,[t(p,{type:"primary",onClick:e[0]||(e[0]=o=>a.$router.push("/admin/dashboard")),class:"back-button"},{default:l(()=>[t(s,null,{default:l(()=>[t(k(le))]),_:1}),e[8]||(e[8]=u(" 返回控制台 ",-1))]),_:1})]),t(x,{class:"feedback-header-card",shadow:"hover"},{header:l(()=>[n("div",ie,[t(s,null,{default:l(()=>[t(k(ne))]),_:1}),e[9]||(e[9]=u(" 反馈管理 ",-1))])]),default:l(()=>[n("div",ue,[t(R,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=o=>y.value=o),placeholder:"搜索反馈标题或内容","prefix-icon":"Search",clearable:"",onInput:T},{append:l(()=>[t(p,{type:"primary",onClick:T},{default:l(()=>[t(s,null,{default:l(()=>[t(k(se))]),_:1}),e[10]||(e[10]=u(" 搜索 ",-1))]),_:1})]),_:1},8,["modelValue"])])]),_:1}),t(x,{class:"feedback-list-card",shadow:"hover"},{default:l(()=>[C.value?(c(),b("div",ce,[t(K,{rows:10,animated:""})])):I.value.length===0?(c(),b("div",pe,[t(O,{description:"暂无反馈"})])):(c(),b("div",ve,[t(G,{data:S.value,stripe:"",style:{width:"100%"}},{default:l(()=>[t(m,{prop:"feedbackId",label:"反馈ID",width:"80"}),t(m,{prop:"title",label:"标题","min-width":"200"}),t(m,{prop:"content",label:"内容","min-width":"300"},{default:l(o=>[u(v(E(o.row.content,50)),1)]),_:1}),t(m,{prop:"userId",label:"用户ID",width:"100"}),t(m,{prop:"feedbackDate",label:"提交时间",width:"180"},{default:l(o=>[u(v(z(o.row.feedbackDate)),1)]),_:1}),t(m,{label:"操作",width:"200"},{default:l(o=>[t(p,{type:"primary",size:"small",onClick:Y=>P(o.row)},{default:l(()=>[t(s,null,{default:l(()=>[t(k(oe))]),_:1}),e[11]||(e[11]=u(" 查看详情 ",-1))]),_:1},8,["onClick"]),t(p,{type:"success",size:"small",onClick:Y=>q(o.row)},{default:l(()=>[t(s,null,{default:l(()=>[t(k($))]),_:1}),e[12]||(e[12]=u(" 回复 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),n("div",fe,[t(J,{"current-page":w.value,"onUpdate:currentPage":e[2]||(e[2]=o=>w.value=o),"page-size":h.value,"onUpdate:pageSize":e[3]||(e[3]=o=>h.value=o),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:S.value.length,onSizeChange:j,onCurrentChange:A},null,8,["current-page","page-size","total"])])]))]),_:1}),t(X,{modelValue:f.value,"onUpdate:modelValue":e[7]||(e[7]=o=>f.value=o),title:d.value?"反馈详情":"回复反馈",width:"600px"},{footer:l(()=>[n("span",Fe,[t(p,{onClick:e[5]||(e[5]=o=>f.value=!1)},{default:l(()=>[...e[18]||(e[18]=[u("关闭",-1)])]),_:1}),_.value?(c(),U(p,{key:0,type:"primary",onClick:H,loading:D.value},{default:l(()=>[...e[19]||(e[19]=[u(" 发送回复 ",-1)])]),_:1},8,["loading"])):(c(),U(p,{key:1,type:"success",onClick:e[6]||(e[6]=o=>_.value=!0)},{default:l(()=>[t(s,null,{default:l(()=>[t(k($))]),_:1}),e[20]||(e[20]=u(" 回复 ",-1))]),_:1}))])]),default:l(()=>[d.value?(c(),b("div",_e,[n("div",me,[e[13]||(e[13]=n("span",{class:"label"},"反馈ID: ",-1)),n("span",be,v(d.value.feedbackId),1)]),n("div",ke,[e[14]||(e[14]=n("span",{class:"label"},"标题: ",-1)),n("span",ge,v(d.value.title),1)]),n("div",ye,[e[15]||(e[15]=n("span",{class:"label"},"用户ID: ",-1)),n("span",we,v(d.value.userId),1)]),n("div",Ce,[e[16]||(e[16]=n("span",{class:"label"},"提交时间: ",-1)),n("span",he,v(z(d.value.feedbackDate)),1)]),n("div",Ie,[e[17]||(e[17]=n("span",{class:"label"},"内容: ",-1)),n("div",Ve,v(d.value.content),1)])])):M("",!0),_.value?(c(),b("div",De,[t(W,{model:g.value,rules:B,ref_key:"replyFormRef",ref:V,"label-width":"80px"},{default:l(()=>[t(Q,{label:"回复内容",prop:"content"},{default:l(()=>[t(R,{modelValue:g.value.content,"onUpdate:modelValue":e[4]||(e[4]=o=>g.value.content=o),type:"textarea",rows:4,placeholder:"请输入回复内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):M("",!0)]),_:1},8,["modelValue","title"])])}}},Re=Z(ze,[["__scopeId","data-v-f8bbc75e"]]);export{Re as default};

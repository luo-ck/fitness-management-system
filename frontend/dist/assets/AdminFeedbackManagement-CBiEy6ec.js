import{_ as Z,r as i,c as ee,o as te,b as g,h as n,d as t,w as l,e as r,f as $,E as z,a as ae,g as p,i as u,j as b,O as le,P as se,M as ne,t as v,v as oe,H as N,s as M,x as U}from"./index-DZFSj2VF.js";const de={class:"admin-feedback-container"},re={class:"back-button-container"},ie={class:"feedback-title"},ue={class:"search-filter"},ce={key:0,class:"loading-container"},pe={key:1,class:"empty-container"},ve={key:2,class:"feedback-list"},me={class:"pagination-container"},_e={key:0,class:"feedback-detail"},fe={class:"detail-item"},ge={class:"value"},be={class:"detail-item"},ye={class:"value"},ke={class:"detail-item"},we={class:"value"},Ce={class:"detail-item"},he={class:"value"},Ie={class:"detail-item detail-content"},Ve={class:"value"},Se={key:1,class:"reply-form-container"},Fe={class:"dialog-footer"},Te={__name:"AdminFeedbackManagement",setup(ze){ae();const I=i(!1),k=i(""),w=i(1),V=i(10),S=i([]),m=i(!1),d=i(null),_=i(!1),F=i(null),T=i(!1),y=i({content:""}),B={content:[{required:!0,message:"请输入回复内容",trigger:"blur"}]},D=a=>a?new Date(a).toLocaleString():"",E=(a,e)=>a?a.length<=e?a:a.substring(0,e)+"...":"",R=ee(()=>{let a=[...S.value];if(k.value){const e=k.value.toLowerCase();a=a.filter(s=>s.title.toLowerCase().includes(e)||s.content.toLowerCase().includes(e))}return a}),L=async()=>{var a,e;I.value=!0;try{const s=JSON.parse(localStorage.getItem("admin")),c=(s==null?void 0:s.id)||1,C=await $.get(`/messages/receiver/${c}/admin`);S.value=(C.data||[]).filter(h=>h.messageType==="system_feedback")}catch(s){console.error("获取反馈列表失败:",s),z.error("获取反馈列表失败: "+(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.message)||s.message))}finally{I.value=!1}},x=()=>{w.value=1},O=a=>{V.value=a},P=a=>{w.value=a},j=a=>{d.value=a,_.value=!1,m.value=!0},q=a=>{d.value=a,_.value=!0,m.value=!0,y.value.content=""},A=async()=>{var a,e;if(!(!F.value||!d.value))try{await F.value.validate(),T.value=!0;const s={senderId:1,senderName:"管理员",receiverId:d.value.senderId,receiverType:"user",messageType:"feedback_reply",title:"反馈回复",content:y.value.content,relatedId:d.value.id,isRead:!1,sendTime:new Date().toISOString().slice(0,19).replace("T"," ")};await $.post("/messages",s),z.success("回复发送成功"),m.value=!1,_.value=!1}catch(s){if(s.name==="ValidateError")return;z.error("发送回复失败: "+(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.message)||s.message))}finally{T.value=!1}};return te(()=>{L()}),(a,e)=>{const s=r("el-icon"),c=r("el-button"),C=r("el-input"),h=r("el-card"),H=r("el-skeleton"),J=r("el-empty"),f=r("el-table-column"),K=r("el-table"),G=r("el-pagination"),Q=r("el-form-item"),W=r("el-form"),X=r("el-dialog");return p(),g("div",de,[n("div",re,[t(c,{type:"primary",onClick:e[0]||(e[0]=o=>a.$router.push("/admin/dashboard")),class:"back-button"},{default:l(()=>[t(s,null,{default:l(()=>[t(b(le))]),_:1}),e[8]||(e[8]=u(" 返回控制台 ",-1))]),_:1})]),t(h,{class:"feedback-header-card",shadow:"hover"},{header:l(()=>[n("div",ie,[t(s,null,{default:l(()=>[t(b(ne))]),_:1}),e[9]||(e[9]=u(" 反馈管理 ",-1))])]),default:l(()=>[n("div",ue,[t(C,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=o=>k.value=o),placeholder:"搜索反馈标题或内容","prefix-icon":"Search",clearable:"",onInput:x},{append:l(()=>[t(c,{type:"primary",onClick:x},{default:l(()=>[t(s,null,{default:l(()=>[t(b(se))]),_:1}),e[10]||(e[10]=u(" 搜索 ",-1))]),_:1})]),_:1},8,["modelValue"])])]),_:1}),t(h,{class:"feedback-list-card",shadow:"hover"},{default:l(()=>[I.value?(p(),g("div",ce,[t(H,{rows:10,animated:""})])):S.value.length===0?(p(),g("div",pe,[t(J,{description:"暂无反馈"})])):(p(),g("div",ve,[t(K,{data:R.value,stripe:"",style:{width:"100%"}},{default:l(()=>[t(f,{prop:"id",label:"反馈ID",width:"80"}),t(f,{prop:"title",label:"标题","min-width":"200"}),t(f,{prop:"content",label:"内容","min-width":"300"},{default:l(o=>[u(v(E(o.row.content,50)),1)]),_:1}),t(f,{prop:"senderId",label:"用户ID",width:"100"}),t(f,{prop:"sendTime",label:"提交时间",width:"180"},{default:l(o=>[u(v(D(o.row.sendTime)),1)]),_:1}),t(f,{label:"操作",width:"200"},{default:l(o=>[t(c,{type:"primary",size:"small",onClick:Y=>j(o.row)},{default:l(()=>[t(s,null,{default:l(()=>[t(b(oe))]),_:1}),e[11]||(e[11]=u(" 查看详情 ",-1))]),_:1},8,["onClick"]),t(c,{type:"success",size:"small",onClick:Y=>q(o.row)},{default:l(()=>[t(s,null,{default:l(()=>[t(b(N))]),_:1}),e[12]||(e[12]=u(" 回复 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),n("div",me,[t(G,{"current-page":w.value,"onUpdate:currentPage":e[2]||(e[2]=o=>w.value=o),"page-size":V.value,"onUpdate:pageSize":e[3]||(e[3]=o=>V.value=o),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:R.value.length,onSizeChange:O,onCurrentChange:P},null,8,["current-page","page-size","total"])])]))]),_:1}),t(X,{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=o=>m.value=o),title:d.value?"反馈详情":"回复反馈",width:"600px"},{footer:l(()=>[n("span",Fe,[t(c,{onClick:e[5]||(e[5]=o=>m.value=!1)},{default:l(()=>[...e[18]||(e[18]=[u("关闭",-1)])]),_:1}),_.value?(p(),U(c,{key:0,type:"primary",onClick:A,loading:T.value},{default:l(()=>[...e[19]||(e[19]=[u(" 发送回复 ",-1)])]),_:1},8,["loading"])):(p(),U(c,{key:1,type:"success",onClick:e[6]||(e[6]=o=>_.value=!0)},{default:l(()=>[t(s,null,{default:l(()=>[t(b(N))]),_:1}),e[20]||(e[20]=u(" 回复 ",-1))]),_:1}))])]),default:l(()=>[d.value?(p(),g("div",_e,[n("div",fe,[e[13]||(e[13]=n("span",{class:"label"},"反馈ID: ",-1)),n("span",ge,v(d.value.id),1)]),n("div",be,[e[14]||(e[14]=n("span",{class:"label"},"标题: ",-1)),n("span",ye,v(d.value.title),1)]),n("div",ke,[e[15]||(e[15]=n("span",{class:"label"},"用户ID: ",-1)),n("span",we,v(d.value.senderId),1)]),n("div",Ce,[e[16]||(e[16]=n("span",{class:"label"},"提交时间: ",-1)),n("span",he,v(D(d.value.sendTime)),1)]),n("div",Ie,[e[17]||(e[17]=n("span",{class:"label"},"内容: ",-1)),n("div",Ve,v(d.value.content),1)])])):M("",!0),_.value?(p(),g("div",Se,[t(W,{model:y.value,rules:B,ref_key:"replyFormRef",ref:F,"label-width":"80px"},{default:l(()=>[t(Q,{label:"回复内容",prop:"content"},{default:l(()=>[t(C,{modelValue:y.value.content,"onUpdate:modelValue":e[4]||(e[4]=o=>y.value.content=o),type:"textarea",rows:4,placeholder:"请输入回复内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):M("",!0)]),_:1},8,["modelValue","title"])])}}},Re=Z(Te,[["__scopeId","data-v-4e85f586"]]);export{Re as default};

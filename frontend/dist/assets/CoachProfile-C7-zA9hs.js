import{_ as ve,u as fe,r as m,m as W,c as me,I as ge,o as _e,a as ye,b as k,h as n,d as o,x as I,s as B,w as l,e as p,f as w,E as u,g as f,i,j as v,q as he,k as S,J as F,y as N,t as D,F as Ve,z as Ue,D as we}from"./index-BLeD9o99.js";const ke={class:"coach-profile-container"},be={class:"back-button-container"},Ce={class:"profile-title"},Ie={class:"profile-nav"},Fe={class:"card-title"},De={class:"form-actions"},$e={class:"card-title"},Re={class:"videos-header"},xe={key:2,class:"selected-file-info"},Le={class:"dialog-footer"},ze={key:0,class:"loading-container"},Me={key:1,class:"empty-container"},qe={key:2,class:"videos-list"},Ae={class:"video-header"},Be={class:"video-title"},Se={class:"video-content"},Ne={class:"video-preview"},Pe={class:"video-info"},je={class:"video-url"},Ee={__name:"CoachProfile",setup(Oe){const R=ye(),b=fe(),y=m("profile"),x=m(null),c=W({coachId:"",username:"",name:"",contact:"",specialty:"",intro:""}),J={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],contact:[{required:!0,message:"请输入联系方式",trigger:"blur"}]},h=m([]),L=m(!1),z=m(!1),M=m(!1),U=m(!1),V=m("url"),C=m([]),G=me(()=>Array.isArray(h.value)?h.value.filter(t=>t&&t.videoId):[]),P=m(null),s=W({title:"",description:"",videoUrl:"",videoFile:null}),H={title:[{required:!0,message:"请输入视频标题",trigger:"blur"}]},j=async()=>{try{const t=b.currentUser;if(t){const r=(await w.get(`/coaches/${t.coachId}`)).data;Object.assign(c,r)}}catch(t){console.error("获取教练信息失败:",t),u.error("获取教练信息失败")}},q=async()=>{try{L.value=!0;const t=b.currentUser;if(console.log("=== 获取教练视频列表 ==="),console.log("当前教练信息:",t),!t){console.error("获取视频列表失败: 教练信息为空"),u.error("获取视频列表失败: 教练信息为空"),h.value=[];return}const e=t.coachId||t.userId||t.id;console.log("使用的教练ID:",e);const r=await w.get(`/trainer/videos/coach/${e}`);console.log("=== 获取视频列表成功 ==="),console.log("响应状态:",r.status),console.log("响应数据:",r.data),h.value=Array.isArray(r.data)?r.data:[]}catch(t){console.error("=== 获取视频列表失败 ==="),console.error("错误类型:",typeof t),console.error("错误对象:",t),t.response?(console.error("响应状态:",t.response.status),console.error("响应数据:",t.response.data),u.error(`获取视频列表失败: ${t.response.status} - ${t.response.data}`)):t.request?(console.error("请求已发送但未收到响应:",t.request),u.error("获取视频列表失败: 网络连接问题")):(console.error("请求配置错误:",t.message),u.error(`获取视频列表失败: ${t.message}`)),h.value=[]}finally{L.value=!1,console.log("=== 获取视频列表流程结束 ===")}},K=async()=>{if(!x.value)return;if(!await x.value.validate()){u.warning("请填写完整的个人信息");return}try{z.value=!0;const e=await w.put(`/coaches/${c.coachId}`,c);b.setCurrentUser(e.data),u.success("个人信息更新成功")}catch(e){console.error("更新个人信息失败:",e),u.error("更新个人信息失败")}finally{z.value=!1}},Q=()=>{V.value==="url"?(s.videoFile=null,C.value=[]):s.videoUrl=""},X=t=>{s.videoFile=t.raw,C.value=[t]},Y=async()=>{if(P.value){if(!s.title){u.warning("请输入视频标题");return}if(V.value==="url"&&!s.videoUrl){u.warning("请输入视频URL");return}else if(V.value==="file"&&!s.videoFile){u.warning("请选择视频文件");return}try{M.value=!0;const t=b.currentUser;if(!t)return;if(V.value==="url"){const e={title:s.title,description:s.description,videoUrl:s.videoUrl,coachId:t.coachId};await w.post("/trainer/videos",e)}else{const e=new FormData;e.append("title",String(s.title)),e.append("description",String(s.description)),e.append("coachId",String(t.coachId)),e.append("videoFile",s.videoFile),console.log("=== 准备发送文件上传请求 ==="),console.log("title:",s.title),console.log("description:",s.description),console.log("coachId:",t.coachId),console.log("videoFile:",s.videoFile),console.log("formData has title:",e.has("title")),console.log("formData has description:",e.has("description")),console.log("formData has coachId:",e.has("coachId")),console.log("formData has videoFile:",e.has("videoFile")),await w.post("/trainer/videos/upload",e),console.log("=== 文件上传请求发送成功 ===")}u.success("视频上传成功"),U.value=!1,Object.assign(s,{title:"",description:"",videoUrl:"",videoFile:null}),C.value=[],V.value="url",q()}catch(t){console.error("上传视频失败:",t),u.error("上传视频失败")}finally{M.value=!1}}},Z=async t=>{try{await w.delete(`/trainer/videos/${t}`),u.success("视频删除成功"),h.value=h.value.filter(e=>e.videoId!==t)}catch(e){console.error("删除视频失败:",e),u.error("删除视频失败")}},ee=async t=>{try{const r=(await w.get(`/trainer/videos/${t}`)).data;if(r&&r.videoUrl){const d=r.videoUrl,A=d.startsWith("http")?new URL(d).pathname:d;window.open(A,"_blank")}else u.error("视频URL无效")}catch(e){console.error("获取视频信息失败:",e),u.error("获取视频信息失败")}},oe=()=>{Object.assign(s,{title:"",description:"",videoUrl:""}),U.value=!1},le=()=>{j()},te=t=>t?new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",ae=()=>{R.push("/coach/dashboard")},se=()=>{R.push("/coach/chat")};return ge(y,t=>{t==="videos"&&q()}),_e(()=>{if(!b.isAuthenticated){R.push("/coach/login");return}j(),y.value==="videos"&&q()}),(t,e)=>{const r=p("el-icon"),d=p("el-button"),A=p("ChatDotRound"),$=p("el-card"),g=p("el-input"),_=p("el-form-item"),E=p("el-col"),re=p("el-row"),O=p("el-form"),T=p("el-radio"),ne=p("el-radio-group"),ie=p("el-upload"),de=p("el-dialog"),ue=p("el-skeleton"),ce=p("el-empty");return f(),k("div",ke,[n("div",be,[o(d,{onClick:ae},{default:l(()=>[o(r,null,{default:l(()=>[o(v(he))]),_:1}),e[17]||(e[17]=i(" 返回控制台 ",-1))]),_:1})]),o($,{class:"profile-header-card",shadow:"hover"},{header:l(()=>[n("div",Ce,[o(r,null,{default:l(()=>[o(v(S))]),_:1}),e[18]||(e[18]=i(" 我的个人中心 ",-1))])]),default:l(()=>[n("div",Ie,[o(d,{type:y.value==="profile"?"primary":"",onClick:e[0]||(e[0]=a=>y.value="profile"),size:"large"},{default:l(()=>[o(r,null,{default:l(()=>[o(v(S))]),_:1}),e[19]||(e[19]=i(" 个人信息 ",-1))]),_:1},8,["type"]),o(d,{type:y.value==="videos"?"primary":"",onClick:e[1]||(e[1]=a=>y.value="videos"),size:"large"},{default:l(()=>[o(r,null,{default:l(()=>[o(v(F))]),_:1}),e[20]||(e[20]=i(" 教学视频 ",-1))]),_:1},8,["type"]),o(d,{type:"primary",onClick:se,size:"large"},{default:l(()=>[o(r,null,{default:l(()=>[o(A)]),_:1}),e[21]||(e[21]=i(" 消息中心 ",-1))]),_:1})])]),_:1}),y.value==="profile"?(f(),I($,{key:0,class:"profile-card",shadow:"hover"},{header:l(()=>[n("div",Fe,[o(r,null,{default:l(()=>[o(v(S))]),_:1}),e[22]||(e[22]=i(" 个人信息 ",-1))])]),default:l(()=>[o(O,{model:c,rules:J,ref_key:"coachFormRef",ref:x,"label-width":"100px"},{default:l(()=>[o(re,{gutter:20},{default:l(()=>[o(E,{span:12},{default:l(()=>[o(_,{label:"教练ID",prop:"coachId"},{default:l(()=>[o(g,{modelValue:c.coachId,"onUpdate:modelValue":e[2]||(e[2]=a=>c.coachId=a),disabled:"",placeholder:"教练ID"},null,8,["modelValue"])]),_:1}),o(_,{label:"用户名",prop:"username"},{default:l(()=>[o(g,{modelValue:c.username,"onUpdate:modelValue":e[3]||(e[3]=a=>c.username=a),disabled:"",placeholder:"用户名"},null,8,["modelValue"])]),_:1}),o(_,{label:"姓名",prop:"name"},{default:l(()=>[o(g,{modelValue:c.name,"onUpdate:modelValue":e[4]||(e[4]=a=>c.name=a),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),o(_,{label:"联系方式",prop:"contact"},{default:l(()=>[o(g,{modelValue:c.contact,"onUpdate:modelValue":e[5]||(e[5]=a=>c.contact=a),placeholder:"请输入联系方式"},null,8,["modelValue"])]),_:1})]),_:1}),o(E,{span:12},{default:l(()=>[o(_,{label:"专业领域",prop:"specialty"},{default:l(()=>[o(g,{modelValue:c.specialty,"onUpdate:modelValue":e[6]||(e[6]=a=>c.specialty=a),placeholder:"请输入专业领域"},null,8,["modelValue"])]),_:1}),o(_,{label:"简介",prop:"intro"},{default:l(()=>[o(g,{modelValue:c.intro,"onUpdate:modelValue":e[7]||(e[7]=a=>c.intro=a),type:"textarea",rows:3,placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),n("div",De,[o(d,{onClick:le},{default:l(()=>[...e[23]||(e[23]=[i("重置",-1)])]),_:1}),o(d,{type:"primary",onClick:K,loading:z.value},{default:l(()=>[...e[24]||(e[24]=[i(" 保存修改 ",-1)])]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1})):B("",!0),y.value==="videos"?(f(),I($,{key:1,class:"videos-card",shadow:"hover"},{header:l(()=>[n("div",$e,[o(r,null,{default:l(()=>[o(v(F))]),_:1}),e[25]||(e[25]=i(" 我的教学视频 ",-1))])]),default:l(()=>[n("div",Re,[e[27]||(e[27]=n("h3",null,"视频列表",-1)),o(d,{type:"primary",onClick:e[8]||(e[8]=a=>U.value=!0)},{default:l(()=>[o(r,null,{default:l(()=>[o(v(N))]),_:1}),e[26]||(e[26]=i(" 上传新视频 ",-1))]),_:1})]),o(de,{modelValue:U.value,"onUpdate:modelValue":e[15]||(e[15]=a=>U.value=a),title:"上传教学视频",width:"600px","before-close":oe},{footer:l(()=>[n("div",Le,[o(d,{onClick:e[14]||(e[14]=a=>U.value=!1)},{default:l(()=>[...e[32]||(e[32]=[i("取消",-1)])]),_:1}),o(d,{type:"primary",onClick:Y,loading:M.value},{default:l(()=>[...e[33]||(e[33]=[i(" 上传视频 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[o(O,{model:s,rules:H,ref_key:"videoFormRef",ref:P,"label-width":"100px"},{default:l(()=>[o(_,{label:"视频标题",prop:"title"},{default:l(()=>[o(g,{modelValue:s.title,"onUpdate:modelValue":e[9]||(e[9]=a=>s.title=a),placeholder:"请输入视频标题"},null,8,["modelValue"])]),_:1}),o(_,{label:"视频描述",prop:"description"},{default:l(()=>[o(g,{modelValue:s.description,"onUpdate:modelValue":e[10]||(e[10]=a=>s.description=a),type:"textarea",rows:3,placeholder:"请输入视频描述"},null,8,["modelValue"])]),_:1}),o(_,{label:"视频上传",prop:"videoUrl"},{default:l(()=>[o(ne,{modelValue:V.value,"onUpdate:modelValue":e[11]||(e[11]=a=>V.value=a),onChange:Q},{default:l(()=>[o(T,{label:"url"},{default:l(()=>[...e[28]||(e[28]=[i("视频URL",-1)])]),_:1}),o(T,{label:"file"},{default:l(()=>[...e[29]||(e[29]=[i("本地文件",-1)])]),_:1})]),_:1},8,["modelValue"]),V.value==="url"?(f(),I(g,{key:0,modelValue:s.videoUrl,"onUpdate:modelValue":e[12]||(e[12]=a=>s.videoUrl=a),placeholder:"请输入视频的完整URL地址"},null,8,["modelValue"])):(f(),I(ie,{key:1,"file-list":C.value,"onUpdate:fileList":e[13]||(e[13]=a=>C.value=a),class:"upload-demo",action:"","auto-upload":!1,"on-change":X,accept:"video/*"},{tip:l(()=>[...e[31]||(e[31]=[n("div",{class:"el-upload__tip"}," 支持MP4、WebM等格式，文件大小不超过100MB ",-1)])]),default:l(()=>[o(d,{type:"primary",size:"small"},{default:l(()=>[o(r,null,{default:l(()=>[o(v(N))]),_:1}),e[30]||(e[30]=i(" 选择视频文件 ",-1))]),_:1})]),_:1},8,["file-list"])),s.videoFile?(f(),k("div",xe,[o(r,null,{default:l(()=>[o(v(F))]),_:1}),i(" "+D(s.videoFile.name),1)])):B("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),L.value?(f(),k("div",ze,[o(ue,{rows:5,animated:""})])):h.value.length===0?(f(),k("div",Me,[o(ce,{description:"暂无教学视频"}),o(d,{type:"primary",onClick:e[16]||(e[16]=a=>U.value=!0),style:{"margin-top":"20px"}},{default:l(()=>[o(r,null,{default:l(()=>[o(v(N))]),_:1}),e[34]||(e[34]=i(" 上传首个视频 ",-1))]),_:1})])):(f(),k("div",qe,[(f(!0),k(Ve,null,Ue(G.value,a=>(f(),I($,{key:a.videoId,class:"video-card",shadow:"hover"},{header:l(()=>[n("div",Ae,[n("span",Be,D(a.title||`视频 ${a.videoId}`),1),o(d,{type:"danger",size:"small",onClick:pe=>Z(a.videoId)},{default:l(()=>[o(r,null,{default:l(()=>[o(v(we))]),_:1}),e[35]||(e[35]=i(" 删除 ",-1))]),_:1},8,["onClick"])])]),default:l(()=>[n("div",Se,[n("div",Ne,[o(r,{class:"video-icon"},{default:l(()=>[o(v(F))]),_:1}),o(d,{type:"primary",size:"small",onClick:pe=>ee(a.videoId)},{default:l(()=>[o(r,null,{default:l(()=>[o(v(F))]),_:1}),e[36]||(e[36]=i(" 查看视频 ",-1))]),_:1},8,["onClick"])]),n("div",Pe,[n("p",null,[e[37]||(e[37]=n("strong",null,"视频URL：",-1)),n("span",je,D(a.videoUrl),1)]),n("p",null,[e[38]||(e[38]=n("strong",null,"描述：",-1)),i(D(a.description||"暂无描述"),1)]),n("p",null,[e[39]||(e[39]=n("strong",null,"上传时间：",-1)),i(D(te(a.uploadDate)),1)])])])]),_:2},1024))),128))]))]),_:1})):B("",!0)])}}},We=ve(Ee,[["__scopeId","data-v-09013d41"]]);export{We as default};

import{_ as ye,u as he,I as Ue,r as m,c as P,m as H,J as Ve,o as we,a as be,f as V,b as k,h as n,d as o,x as I,s as M,w as l,e as p,E as u,g as f,i as d,j as v,q as Ce,k as j,K as R,y as E,t as x,F as ke,z as Ie,D as Fe}from"./index-CE4dHlk9.js";const De={class:"coach-profile-container"},$e={class:"back-button-container"},Re={class:"profile-title"},xe={class:"profile-nav"},Le={class:"message-center-button-wrapper"},Me={class:"card-title"},ze={class:"form-actions"},Se={class:"card-title"},Ae={class:"videos-header"},qe={key:2,class:"selected-file-info"},Be={class:"dialog-footer"},Ne={key:0,class:"loading-container"},Pe={key:1,class:"empty-container"},je={key:2,class:"videos-list"},Ee={class:"video-header"},Oe={class:"video-title"},Te={class:"video-content"},We={class:"video-preview"},Je={class:"video-info"},Ke={class:"video-url"},Ge={__name:"CoachProfile",setup(He){const z=be(),w=he(),F=Ue(),y=m("profile"),Q=P(()=>F.unreadCount),O=P(()=>F.hasUnreadMessages),S=m(null),c=H({coachId:"",username:"",name:"",contact:"",specialty:"",intro:""}),X={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],contact:[{required:!0,message:"请输入联系方式",trigger:"blur"}]},h=m([]),A=m(!1),q=m(!1),B=m(!1),b=m(!1),U=m("url"),D=m([]),Y=P(()=>Array.isArray(h.value)?h.value.filter(t=>t&&t.videoId):[]),T=m(null),r=H({title:"",description:"",videoUrl:"",videoFile:null}),Z={title:[{required:!0,message:"请输入视频标题",trigger:"blur"}]},W=async()=>{try{const t=w.currentUser;if(t){const s=(await V.get(`/coaches/${t.coachId}`)).data;Object.assign(c,s)}}catch(t){console.error("获取教练信息失败:",t),u.error("获取教练信息失败")}},N=async()=>{try{A.value=!0;const t=w.currentUser;if(console.log("=== 获取教练视频列表 ==="),console.log("当前教练信息:",t),!t){console.error("获取视频列表失败: 教练信息为空"),u.error("获取视频列表失败: 教练信息为空"),h.value=[];return}const e=t.coachId||t.userId||t.id;console.log("使用的教练ID:",e);const s=await V.get(`/trainer/videos/coach/${e}`);console.log("=== 获取视频列表成功 ==="),console.log("响应状态:",s.status),console.log("响应数据:",s.data),h.value=Array.isArray(s.data)?s.data:[]}catch(t){console.error("=== 获取视频列表失败 ==="),console.error("错误类型:",typeof t),console.error("错误对象:",t),t.response?(console.error("响应状态:",t.response.status),console.error("响应数据:",t.response.data),u.error(`获取视频列表失败: ${t.response.status} - ${t.response.data}`)):t.request?(console.error("请求已发送但未收到响应:",t.request),u.error("获取视频列表失败: 网络连接问题")):(console.error("请求配置错误:",t.message),u.error(`获取视频列表失败: ${t.message}`)),h.value=[]}finally{A.value=!1,console.log("=== 获取视频列表流程结束 ===")}},ee=async()=>{if(!S.value)return;if(!await S.value.validate()){u.warning("请填写完整的个人信息");return}try{q.value=!0;const e=await V.put(`/coaches/${c.coachId}`,c);w.setCurrentUser(e.data),u.success("个人信息更新成功")}catch(e){console.error("更新个人信息失败:",e),u.error("更新个人信息失败")}finally{q.value=!1}},oe=()=>{U.value==="url"?(r.videoFile=null,D.value=[]):r.videoUrl=""},le=t=>{r.videoFile=t.raw,D.value=[t]},te=async()=>{if(T.value){if(!r.title){u.warning("请输入视频标题");return}if(U.value==="url"&&!r.videoUrl){u.warning("请输入视频URL");return}else if(U.value==="file"&&!r.videoFile){u.warning("请选择视频文件");return}try{B.value=!0;const t=w.currentUser;if(!t)return;if(U.value==="url"){const e={title:r.title,description:r.description,videoUrl:r.videoUrl,coachId:t.coachId};await V.post("/trainer/videos",e)}else{const e=new FormData;e.append("title",String(r.title)),e.append("description",String(r.description)),e.append("coachId",String(t.coachId)),e.append("videoFile",r.videoFile),console.log("=== 准备发送文件上传请求 ==="),console.log("title:",r.title),console.log("description:",r.description),console.log("coachId:",t.coachId),console.log("videoFile:",r.videoFile),console.log("formData has title:",e.has("title")),console.log("formData has description:",e.has("description")),console.log("formData has coachId:",e.has("coachId")),console.log("formData has videoFile:",e.has("videoFile")),await V.post("/trainer/videos/upload",e),console.log("=== 文件上传请求发送成功 ===")}u.success("视频上传成功"),b.value=!1,Object.assign(r,{title:"",description:"",videoUrl:"",videoFile:null}),D.value=[],U.value="url",N()}catch(t){console.error("上传视频失败:",t),u.error("上传视频失败")}finally{B.value=!1}}},ae=async t=>{try{await V.delete(`/trainer/videos/${t}`),u.success("视频删除成功"),h.value=h.value.filter(e=>e.videoId!==t)}catch(e){console.error("删除视频失败:",e),u.error("删除视频失败")}},se=async t=>{try{const s=(await V.get(`/trainer/videos/${t}`)).data;if(s&&s.videoUrl){const i=s.videoUrl,C=i.startsWith("http")?new URL(i).pathname:i;window.open(C,"_blank")}else u.error("视频URL无效")}catch(e){console.error("获取视频信息失败:",e),u.error("获取视频信息失败")}},re=()=>{Object.assign(r,{title:"",description:"",videoUrl:""}),b.value=!1},ne=()=>{W()},de=t=>t?new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",ie=()=>{z.push("/coach/dashboard")},ue=()=>{z.push("/coach/chat")};return Ve(y,t=>{t==="videos"&&N()}),we(async()=>{var t,e;if(!w.isAuthenticated){z.push("/coach/login");return}W(),y.value==="videos"&&N();try{const s=((t=w.currentUser)==null?void 0:t.userId)||((e=w.currentUser)==null?void 0:e.coachId);if(s){const C=(await V.get(`/messages/conversations/${s}`)).data||[];console.log("获取到的对话列表:",C),F.resetAllUnreadCounts(),C.forEach($=>{$.unreadCount>0&&F.setConversationUnreadCount($.otherId,$.unreadCount)}),console.log("初始化后的全局未读消息计数:",F.unreadCount)}}catch(s){console.error("获取对话列表失败:",s)}}),(t,e)=>{const s=p("el-icon"),i=p("el-button"),C=p("ChatDotRound"),$=p("el-badge"),L=p("el-card"),g=p("el-input"),_=p("el-form-item"),J=p("el-col"),ce=p("el-row"),K=p("el-form"),G=p("el-radio"),pe=p("el-radio-group"),ve=p("el-upload"),fe=p("el-dialog"),me=p("el-skeleton"),ge=p("el-empty");return f(),k("div",De,[n("div",$e,[o(i,{onClick:ie},{default:l(()=>[o(s,null,{default:l(()=>[o(v(Ce))]),_:1}),e[17]||(e[17]=d(" 返回控制台 ",-1))]),_:1})]),o(L,{class:"profile-header-card",shadow:"hover"},{header:l(()=>[n("div",Re,[o(s,null,{default:l(()=>[o(v(j))]),_:1}),e[18]||(e[18]=d(" 我的个人中心 ",-1))])]),default:l(()=>[n("div",xe,[o(i,{type:y.value==="profile"?"primary":"",onClick:e[0]||(e[0]=a=>y.value="profile"),size:"large"},{default:l(()=>[o(s,null,{default:l(()=>[o(v(j))]),_:1}),e[19]||(e[19]=d(" 个人信息 ",-1))]),_:1},8,["type"]),o(i,{type:y.value==="videos"?"primary":"",onClick:e[1]||(e[1]=a=>y.value="videos"),size:"large"},{default:l(()=>[o(s,null,{default:l(()=>[o(v(R))]),_:1}),e[20]||(e[20]=d(" 教学视频 ",-1))]),_:1},8,["type"]),n("div",Le,[o(i,{type:"primary",onClick:ue,size:"large",class:"message-center-button"},{default:l(()=>[o(s,null,{default:l(()=>[o(C)]),_:1}),e[21]||(e[21]=d(" 消息中心 ",-1))]),_:1}),O.value?(f(),I($,{key:0,value:Q.value,type:"danger",class:"message-badge",hidden:!O.value},null,8,["value","hidden"])):M("",!0)])])]),_:1}),y.value==="profile"?(f(),I(L,{key:0,class:"profile-card",shadow:"hover"},{header:l(()=>[n("div",Me,[o(s,null,{default:l(()=>[o(v(j))]),_:1}),e[22]||(e[22]=d(" 个人信息 ",-1))])]),default:l(()=>[o(K,{model:c,rules:X,ref_key:"coachFormRef",ref:S,"label-width":"100px"},{default:l(()=>[o(ce,{gutter:20},{default:l(()=>[o(J,{span:12},{default:l(()=>[o(_,{label:"教练ID",prop:"coachId"},{default:l(()=>[o(g,{modelValue:c.coachId,"onUpdate:modelValue":e[2]||(e[2]=a=>c.coachId=a),disabled:"",placeholder:"教练ID"},null,8,["modelValue"])]),_:1}),o(_,{label:"用户名",prop:"username"},{default:l(()=>[o(g,{modelValue:c.username,"onUpdate:modelValue":e[3]||(e[3]=a=>c.username=a),disabled:"",placeholder:"用户名"},null,8,["modelValue"])]),_:1}),o(_,{label:"姓名",prop:"name"},{default:l(()=>[o(g,{modelValue:c.name,"onUpdate:modelValue":e[4]||(e[4]=a=>c.name=a),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),o(_,{label:"联系方式",prop:"contact"},{default:l(()=>[o(g,{modelValue:c.contact,"onUpdate:modelValue":e[5]||(e[5]=a=>c.contact=a),placeholder:"请输入联系方式"},null,8,["modelValue"])]),_:1})]),_:1}),o(J,{span:12},{default:l(()=>[o(_,{label:"专业领域",prop:"specialty"},{default:l(()=>[o(g,{modelValue:c.specialty,"onUpdate:modelValue":e[6]||(e[6]=a=>c.specialty=a),placeholder:"请输入专业领域"},null,8,["modelValue"])]),_:1}),o(_,{label:"简介",prop:"intro"},{default:l(()=>[o(g,{modelValue:c.intro,"onUpdate:modelValue":e[7]||(e[7]=a=>c.intro=a),type:"textarea",rows:3,placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),n("div",ze,[o(i,{onClick:ne},{default:l(()=>[...e[23]||(e[23]=[d("重置",-1)])]),_:1}),o(i,{type:"primary",onClick:ee,loading:q.value},{default:l(()=>[...e[24]||(e[24]=[d(" 保存修改 ",-1)])]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1})):M("",!0),y.value==="videos"?(f(),I(L,{key:1,class:"videos-card",shadow:"hover"},{header:l(()=>[n("div",Se,[o(s,null,{default:l(()=>[o(v(R))]),_:1}),e[25]||(e[25]=d(" 我的教学视频 ",-1))])]),default:l(()=>[n("div",Ae,[e[27]||(e[27]=n("h3",null,"视频列表",-1)),o(i,{type:"primary",onClick:e[8]||(e[8]=a=>b.value=!0)},{default:l(()=>[o(s,null,{default:l(()=>[o(v(E))]),_:1}),e[26]||(e[26]=d(" 上传新视频 ",-1))]),_:1})]),o(fe,{modelValue:b.value,"onUpdate:modelValue":e[15]||(e[15]=a=>b.value=a),title:"上传教学视频",width:"600px","before-close":re},{footer:l(()=>[n("div",Be,[o(i,{onClick:e[14]||(e[14]=a=>b.value=!1)},{default:l(()=>[...e[32]||(e[32]=[d("取消",-1)])]),_:1}),o(i,{type:"primary",onClick:te,loading:B.value},{default:l(()=>[...e[33]||(e[33]=[d(" 上传视频 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[o(K,{model:r,rules:Z,ref_key:"videoFormRef",ref:T,"label-width":"100px"},{default:l(()=>[o(_,{label:"视频标题",prop:"title"},{default:l(()=>[o(g,{modelValue:r.title,"onUpdate:modelValue":e[9]||(e[9]=a=>r.title=a),placeholder:"请输入视频标题"},null,8,["modelValue"])]),_:1}),o(_,{label:"视频描述",prop:"description"},{default:l(()=>[o(g,{modelValue:r.description,"onUpdate:modelValue":e[10]||(e[10]=a=>r.description=a),type:"textarea",rows:3,placeholder:"请输入视频描述"},null,8,["modelValue"])]),_:1}),o(_,{label:"视频上传",prop:"videoUrl"},{default:l(()=>[o(pe,{modelValue:U.value,"onUpdate:modelValue":e[11]||(e[11]=a=>U.value=a),onChange:oe},{default:l(()=>[o(G,{label:"url"},{default:l(()=>[...e[28]||(e[28]=[d("视频URL",-1)])]),_:1}),o(G,{label:"file"},{default:l(()=>[...e[29]||(e[29]=[d("本地文件",-1)])]),_:1})]),_:1},8,["modelValue"]),U.value==="url"?(f(),I(g,{key:0,modelValue:r.videoUrl,"onUpdate:modelValue":e[12]||(e[12]=a=>r.videoUrl=a),placeholder:"请输入视频的完整URL地址"},null,8,["modelValue"])):(f(),I(ve,{key:1,"file-list":D.value,"onUpdate:fileList":e[13]||(e[13]=a=>D.value=a),class:"upload-demo",action:"","auto-upload":!1,"on-change":le,accept:"video/*"},{tip:l(()=>[...e[31]||(e[31]=[n("div",{class:"el-upload__tip"}," 支持MP4、WebM等格式，文件大小不超过100MB ",-1)])]),default:l(()=>[o(i,{type:"primary",size:"small"},{default:l(()=>[o(s,null,{default:l(()=>[o(v(E))]),_:1}),e[30]||(e[30]=d(" 选择视频文件 ",-1))]),_:1})]),_:1},8,["file-list"])),r.videoFile?(f(),k("div",qe,[o(s,null,{default:l(()=>[o(v(R))]),_:1}),d(" "+x(r.videoFile.name),1)])):M("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),A.value?(f(),k("div",Ne,[o(me,{rows:5,animated:""})])):h.value.length===0?(f(),k("div",Pe,[o(ge,{description:"暂无教学视频"}),o(i,{type:"primary",onClick:e[16]||(e[16]=a=>b.value=!0),style:{"margin-top":"20px"}},{default:l(()=>[o(s,null,{default:l(()=>[o(v(E))]),_:1}),e[34]||(e[34]=d(" 上传首个视频 ",-1))]),_:1})])):(f(),k("div",je,[(f(!0),k(ke,null,Ie(Y.value,a=>(f(),I(L,{key:a.videoId,class:"video-card",shadow:"hover"},{header:l(()=>[n("div",Ee,[n("span",Oe,x(a.title||`视频 ${a.videoId}`),1),o(i,{type:"danger",size:"small",onClick:_e=>ae(a.videoId)},{default:l(()=>[o(s,null,{default:l(()=>[o(v(Fe))]),_:1}),e[35]||(e[35]=d(" 删除 ",-1))]),_:1},8,["onClick"])])]),default:l(()=>[n("div",Te,[n("div",We,[o(s,{class:"video-icon"},{default:l(()=>[o(v(R))]),_:1}),o(i,{type:"primary",size:"small",onClick:_e=>se(a.videoId)},{default:l(()=>[o(s,null,{default:l(()=>[o(v(R))]),_:1}),e[36]||(e[36]=d(" 查看视频 ",-1))]),_:1},8,["onClick"])]),n("div",Je,[n("p",null,[e[37]||(e[37]=n("strong",null,"视频URL：",-1)),n("span",Ke,x(a.videoUrl),1)]),n("p",null,[e[38]||(e[38]=n("strong",null,"描述：",-1)),d(x(a.description||"暂无描述"),1)]),n("p",null,[e[39]||(e[39]=n("strong",null,"上传时间：",-1)),d(x(de(a.uploadDate)),1)])])])]),_:2},1024))),128))]))]),_:1})):M("",!0)])}}},Xe=ye(Ge,[["__scopeId","data-v-189456ed"]]);export{Xe as default};

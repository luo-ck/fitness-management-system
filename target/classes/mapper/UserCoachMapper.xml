<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fitness.system.mapper.UserCoachMapper">

    <resultMap type="com.fitness.system.entity.UserCoach" id="UserCoachResult">
        <result property="id" column="id" />
        <result property="userId" column="user_id" />
        <result property="coachId" column="coach_id" />
        <result property="startDate" column="start_date" />
        <result property="isActive" column="is_active" />
    </resultMap>

    <sql id="selectUserCoachVo">
        select id, user_id, coach_id, start_date, is_active from user_coach
    </sql>

    <select id="selectCoachesByUserId" parameterType="Long" resultMap="UserCoachResult">
        <include refid="selectUserCoachVo" />
        where user_id = #{userId}
    </select>

    <select id="selectUsersByCoachId" parameterType="Long" resultMap="UserCoachResult">
        <include refid="selectUserCoachVo" />
        where coach_id = #{coachId}
    </select>

    <select id="checkUserCoachRelation" parameterType="map" resultMap="UserCoachResult">
        <include refid="selectUserCoachVo" />
        where user_id = #{userId} and coach_id = #{coachId}
    </select>

    <insert id="insertUserCoach" parameterType="com.fitness.system.entity.UserCoach" useGeneratedKeys="true" keyProperty="id">
        insert into user_coach
        <trim prefix="(" suffix=")" suffixOverrides=",">
            user_id, coach_id, start_date, is_active
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            #{userId}, #{coachId}, now(), 1
        </trim>
    </insert>

    <delete id="deleteUserCoach" parameterType="map">
        delete from user_coach
        where user_id = #{userId} and coach_id = #{coachId}
    </delete>

</mapper>

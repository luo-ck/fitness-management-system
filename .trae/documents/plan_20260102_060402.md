# 意见反馈功能实现计划

## 1. 需求分析
- 在用户中心下方增加"意见反馈"项
- 用户可填写意见反馈并发送给管理员
- 管理员通过现有"反馈管理"按钮查看并回复
- 回复将发送到用户收件箱中

## 2. 实现方案

### 2.1 前端实现

#### 2.1.1 用户中心添加意见反馈表单
- **修改文件**：`UserCenter.vue`
- **操作**：在用户中心下方添加意见反馈表单
- **功能**：
  - 表单包含标题和内容字段
  - 提交按钮
  - 表单验证
  - 提交成功后显示提示

#### 2.1.2 创建管理员反馈管理组件
- **创建文件**：`AdminFeedbackManagement.vue`
- **功能**：
  - 展示所有用户意见反馈
  - 支持分页和搜索
  - 支持查看反馈详情
  - 支持回复反馈
  - 回复内容发送到用户收件箱

#### 2.1.3 配置路由
- **修改文件**：`router/index.js`
- **操作**：添加新路由 `/admin/feedback` 指向 `AdminFeedbackManagement.vue`

#### 2.1.4 更新管理员仪表板
- **修改文件**：`AdminDashboard.vue`
- **操作**：确保"反馈管理"按钮链接到正确的路由

### 2.2 后端实现

#### 2.2.1 复用现有API
- **现有API**：
  - `/feedback` - 获取所有反馈（管理员使用）
  - `/feedback/{feedbackId}` - 获取单个反馈详情
  - `/messages` - 发送消息（用于管理员回复）
  - `/feedback` - 提交反馈（POST请求）

#### 2.2.2 可能的扩展
- 如果现有API不满足需求，可能需要添加新的API端点
- 例如：获取特定类型的反馈（意见反馈vs训练反馈）

## 3. 数据流程

1. **用户提交反馈**：
   - 用户填写表单并提交
   - 调用 `/feedback` POST API保存反馈
   - 反馈类型标记为"意见反馈"

2. **管理员查看反馈**：
   - 管理员点击"反馈管理"按钮
   - 进入 `AdminFeedbackManagement.vue` 组件
   - 调用 `/feedback` GET API获取所有反馈
   - 过滤或分类显示意见反馈

3. **管理员回复反馈**：
   - 管理员查看反馈详情
   - 填写回复内容
   - 调用 `/messages` POST API发送回复
   - 消息发送给对应的用户
   - 消息类型标记为"反馈回复"

4. **用户查看回复**：
   - 用户打开收件箱
   - 查看管理员的回复消息
   - 消息状态更新为已读

## 4. 技术细节

### 4.1 反馈表单设计
```html
<el-form :model="feedbackForm" :rules="feedbackRules" ref="feedbackFormRef" label-width="80px">
  <el-form-item label="标题" prop="title">
    <el-input v-model="feedbackForm.title" placeholder="请输入反馈标题" />
  </el-form-item>
  <el-form-item label="内容" prop="content">
    <el-input 
      v-model="feedbackForm.content" 
      type="textarea" 
      :rows="4" 
      placeholder="请输入反馈内容" 
    />
  </el-form-item>
  <el-form-item>
    <el-button type="primary" @click="submitFeedback" :loading="submitting">提交反馈</el-button>
  </el-form-item>
</el-form>
```

### 4.2 反馈管理组件设计
- 使用Element Plus的表格组件展示反馈列表
- 支持分页和搜索功能
- 点击查看详情按钮显示反馈详情和回复表单
- 回复表单使用Element Plus的表单组件

### 4.3 消息发送逻辑
- 管理员回复时，调用消息API发送消息
- 消息参数：
  - senderId: 管理员ID
  - senderName: "管理员"
  - receiverId: 用户ID
  - receiverType: "user"
  - messageType: "feedback_reply"
  - title: "反馈回复"
  - content: 回复内容
  - relatedId: 反馈ID

## 5. 预期效果
- 用户中心下方显示意见反馈表单
- 用户可成功提交反馈
- 管理员可在反馈管理页面查看所有反馈
- 管理员可回复反馈
- 用户可在收件箱中查看管理员的回复

## 6. 注意事项
- 确保表单验证合理
- 确保反馈和回复的状态更新正确
- 确保消息发送到正确的用户收件箱
- 保持与现有UI风格一致
- 确保不显示多余字段

## 7. 测试要点
- 用户提交反馈功能
- 管理员查看反馈功能
- 管理员回复反馈功能
- 用户查看回复功能
- 表单验证功能
- 分页和搜索功能

## 8. 代码复用
- 复用现有的消息系统
- 复用现有的反馈API
- 复用现有的UI组件
- 复用现有的表单验证逻辑
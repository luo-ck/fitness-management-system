## 用户申请教练功能及收件箱功能实现计划

### 1. 数据模型设计

#### 1.1 创建 `CoachApplication` 实体

* **用途**：存储用户的教练申请信息
* **字段**：
  - `id`: 申请ID
  - `userId`: 用户ID（外键）
  - `username`: 用户名
  - `name`: 姓名
  - `specialty`: 专长
  - `contact`: 联系方式
  - `intro`: 自我介绍
  - `status`: 申请状态（待审核、通过、拒绝）
  - `applyTime`: 申请时间
  - `approveTime`: 审核时间
  - `adminId`: 审核管理员ID
  - `adminName`: 审核管理员姓名
  - `feedback`: 审核反馈

#### 1.2 创建 `Message` 实体

* **用途**：实现系统消息功能，用于管理员向用户发送反馈
* **字段**：
  - `id`: 消息ID
  - `senderId`: 发送者ID
  - `senderName`: 发送者姓名
  - `receiverId`: 接收者ID
  - `receiverType`: 接收者类型（user/coach/admin）
  - `title`: 消息标题
  - `content`: 消息内容
  - `isRead`: 是否已读
  - `sendTime`: 发送时间
  - `readTime`: 阅读时间

### 2. 后端API设计

#### 2.1 教练申请相关API

* **用户申请成为教练**：`POST /api/coach-applications`
* **获取当前用户的申请状态**：`GET /api/coach-applications/current`
* **管理员获取所有申请列表**：`GET /api/coach-applications`
* **管理员查看单个申请详情**：`GET /api/coach-applications/{id}`
* **管理员审核申请**：`PUT /api/coach-applications/{id}/approve`
* **管理员拒绝申请**：`PUT /api/coach-applications/{id}/reject`

#### 2.2 消息相关API

* **发送消息**：`POST /api/messages`
* **获取当前用户的消息列表**：`GET /api/messages`
* **获取单个消息详情**：`GET /api/messages/{id}`
* **标记消息为已读**：`PUT /api/messages/{id}/read`
* **删除消息**：`DELETE /api/messages/{id}`

### 3. 前端页面设计

#### 3.1 用户端

* **申请教练页面**：
  - 申请表单，包含专长、联系方式、自我介绍等字段
  - 提交按钮
  - 显示当前申请状态

* **收件箱页面**：
  - 消息列表，显示标题、发送者、发送时间、是否已读
  - 消息详情查看
  - 标记已读功能

#### 3.2 管理员端

* **教练申请管理页面**：
  - 申请列表，显示申请人、申请时间、状态
  - 申请详情查看
  - 审核通过/拒绝按钮
  - 审核反馈输入

* **消息管理页面**：
  - 消息发送功能
  - 消息列表管理

### 4. 角色转换逻辑

* **审核通过后**：
  1. 将用户信息复制到教练表
  2. 保持用户表中的记录不变
  3. 发送审核通过消息给用户
  4. 后续用户登录时根据角色自动跳转到相应页面

* **审核拒绝后**：
  1. 更新申请状态为拒绝
  2. 发送拒绝消息给用户，包含拒绝原因

### 5. 认证和授权调整

* **JWT 改进**：在 JWT 中添加角色信息，便于前端识别用户角色
* **前端路由守卫**：根据用户角色自动跳转到相应的首页
* **后端权限控制**：添加基于角色的API访问控制

### 6. 实现步骤

1. **创建数据模型**：
   - 创建 `CoachApplication` 和 `Message` 实体类
   - 创建对应的Mapper接口和XML文件
   - 创建Service接口和实现类
   - 创建Controller类

2. **实现API功能**：
   - 用户申请教练功能
   - 管理员审核功能
   - 消息发送和接收功能
   - 角色转换逻辑

3. **前端页面开发**：
   - 申请教练表单页面
   - 用户收件箱页面
   - 管理员申请管理页面
   - 管理员消息管理页面

4. **认证和授权调整**：
   - 修改JWT生成逻辑，添加角色信息
   - 更新前端路由守卫
   - 添加后端权限控制

### 7. 技术栈

* 后端：Spring Boot + MyBatis
* 前端：Vue 3 + Element Plus
* 认证：JWT
* 数据库：MySQL

### 8. 预期效果

* 用户可以在个人中心申请成为教练
* 管理员可以在后台审核教练申请
* 用户可以通过收件箱接收管理员的审核结果
* 审核通过后，用户自动获得教练角色
* 支持多种角色的用户登录和权限控制

### 9. 文件修改清单

* **后端**：
  - `src/main/java/com/fitness/system/entity/CoachApplication.java`（新增）
  - `src/main/java/com/fitness/system/entity/Message.java`（新增）
  - `src/main/java/com/fitness/system/mapper/CoachApplicationMapper.java`（新增）
  - `src/main/java/com/fitness/system/mapper/MessageMapper.java`（新增）
  - `src/main/resources/mapper/CoachApplicationMapper.xml`（新增）
  - `src/main/resources/mapper/MessageMapper.xml`（新增）
  - `src/main/java/com/fitness/system/service/ICoachApplicationService.java`（新增）
  - `src/main/java/com/fitness/system/service/impl/CoachApplicationServiceImpl.java`（新增）
  - `src/main/java/com/fitness/system/service/IMessageService.java`（新增）
  - `src/main/java/com/fitness/system/service/impl/MessageServiceImpl.java`（新增）
  - `src/main/java/com/fitness/system/controller/CoachApplicationController.java`（新增）
  - `src/main/java/com/fitness/system/controller/MessageController.java`（新增）
  - `src/main/java/com/fitness/system/util/JwtUtil.java`（修改）
  - `src/main/java/com/fitness/system/config/SecurityConfig.java`（修改，可选）

* **前端**：
  - `frontend/src/views/UserApplyCoach.vue`（新增）
  - `frontend/src/views/UserInbox.vue`（新增）
  - `frontend/src/views/AdminCoachApplications.vue`（新增）
  - `frontend/src/views/AdminMessageManagement.vue`（新增）
  - `frontend/src/router/index.js`（修改，添加路由）
  - `frontend/src/services/api.js`（修改，添加API方法）
  - `frontend/src/views/UserCenter.vue`（修改，添加申请教练入口）
  - `frontend/src/views/AdminDashboard.vue`（修改，添加申请管理入口）

### 10. 注意事项

* 确保数据完整性和一致性，尤其是角色转换过程
* 注意消息通知的及时性和准确性
* 保护敏感API，添加适当的权限控制
* 考虑用户体验，提供清晰的申请流程和状态反馈
* 确保系统性能，尤其是消息查询和通知功能
### 1. 数据模型扩展

#### 1.1 扩展 Message 实体
- 添加 `messageType` 字段，区分普通消息、训练计划和反馈
- 添加 `relatedId` 字段，关联训练计划ID或反馈ID

#### 1.2 现有 Feedback 实体已满足需求
- 已包含用户ID、教练ID、训练计划ID、反馈内容、评分等字段
- 无需重新创建，可直接使用

### 2. 后端 API 实现

#### 2.1 对话管理 API
- 新增 `/conversations/{userId}` - 获取用户的对话列表
- 新增 `/messages/conversation/{userId}/{coachId}` - 获取特定对话的消息历史

#### 2.2 训练计划推送 API
- 新增 `/training-plans/{id}/push` - 将训练计划推送到对话框
- 调用现有 `messageService.sendMessage()` 方法发送消息

#### 2.3 反馈推送 API
- 新增 `/feedback/{id}/push` - 将反馈推送到对话框
- 调用现有 `messageService.sendMessage()` 方法发送消息

#### 2.4 WebSocket 实现
- 配置 Spring WebSocket 支持
- 实现消息实时推送功能
- 支持一对一消息发送

### 3. 前端组件开发

#### 3.1 对话列表组件（ConversationList.vue）
- 显示对话对象列表（教练/学员）
- 显示未读消息数量
- 支持搜索对话对象
- 集成到教练和学员的侧边栏导航

#### 3.2 对话框组件（ChatDialog.vue）
- 顶部显示对话对象信息
- 中部显示消息历史，支持三种消息类型：
  - 普通消息：文本消息
  - 训练计划：集成现有 `TrainingPlanCard` 组件
  - 反馈：集成现有反馈显示样式
- 底部提供消息输入框，支持自定义消息发送
- 支持附件上传

#### 3.3 消息卡片组件（MessageCard.vue）
- 根据消息类型显示不同的卡片样式
- 普通消息：显示发送者、内容、时间
- 训练计划：显示训练计划日期和简要信息，支持查看详情
- 反馈：显示反馈评分和内容

### 4. 系统集成

#### 4.1 与现有训练计划系统集成
- 在教练创建/更新训练计划时，自动调用推送API
- 训练计划卡片与现有 `UserMyTraining.vue` 中的计划详情联动

#### 4.2 与现有反馈系统集成
- 在学员提交反馈时，自动调用推送API
- 反馈显示与现有 `UserMyTraining.vue` 中的反馈样式保持一致

#### 4.3 与现有认证授权机制集成
- 复用现有 `authStore` 和路由守卫
- 基于用户类型控制对话权限

### 5. 实现步骤

1. 扩展 `Message` 实体，添加 `messageType` 和 `relatedId` 字段
2. 实现后端对话管理 API
3. 实现 WebSocket 支持
4. 开发前端对话列表和对话框组件
5. 集成现有训练计划和反馈组件到对话框
6. 测试并优化用户体验

### 6. 关键代码修改点

- 后端：
  - `Message.java` - 扩展实体
  - `MessageController.java` - 扩展 API
  - `TrainingPlanController.java` - 添加推送功能
  - `FeedbackController.java` - 添加推送功能
  - `WebSocketConfig.java` - 新增配置

- 前端：
  - `src/views/ConversationList.vue` - 新增组件
  - `src/views/ChatDialog.vue` - 新增组件
  - `src/components/MessageCard.vue` - 新增组件
  - `src/services/api.js` - 扩展 API 调用
  - `src/store/chatStore.js` - 新增状态管理
  - `src/router/index.js` - 添加对话相关路由

### 7. 与现有系统的兼容点

- 复用现有 `TrainingPlan` 和 `Feedback` 实体
- 复用现有 `UserMyTraining.vue` 中的训练计划详情和反馈样式
- 复用现有 `authStore` 进行用户认证
- 复用现有 `messageService` 进行消息发送

### 8. 预期效果

- 教练和学员可以在专属对话框中进行实时交流
- 训练计划自动推送到对话框，学员可以直接查看详情
- 学员提交反馈后，教练可以立即收到通知
- 支持自定义消息发送，方便教练和学员沟通
- 所有对话历史和反馈记录都被保存，便于查阅

这个实施计划将确保教练与学员之间的对话框功能能够顺利实现，并且与现有系统无缝集成，提升系统的整体用户体验。
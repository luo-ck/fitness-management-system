# 教练评价功能实现计划

## 1. 需求分析
- 在用户中心我的教练下方教练名片右边“取消选择”按钮上方增加“去评价”按钮
- 点击后可为教练按星级打分并评价
- 在已验证教练列表的名片中点击“查看评价”来查看各教练综合评分以及所有评价
- 在教练端个人中心中增添“我的评价”一栏，查看个人综合评分以及所有评价
- 评价列表查看时可以看到每个评价的发起人、发起时间、评分与评价详情

## 2. 实现方案

### 2.1 后端实现

#### 2.1.1 创建评价实体
- **实体类**：`CoachRating`
- **字段**：
  - `ratingId`：评价ID
  - `userId`：评价发起人ID
  - `userName`：评价发起人姓名
  - `coachId`：被评价教练ID
  - `rating`：评分（1-5星）
  - `comment`：评价内容
  - `createTime`：创建时间

#### 2.1.2 创建Mapper和Service
- **Mapper接口**：`CoachRatingMapper`
- **Mapper XML**：`CoachRatingMapper.xml`
- **Service接口**：`ICoachRatingService`
- **Service实现**：`CoachRatingServiceImpl`

#### 2.1.3 创建API接口
- `/coach-ratings`：提交评价（POST）
- `/coach-ratings/coach/{coachId}`：获取教练的评价列表（GET）
- `/coach-ratings/coach/{coachId}/average`：获取教练的平均评分（GET）

#### 2.1.4 数据库同步
- **方式**：根据项目现有配置，选择合适的数据库同步方式
  - 若使用MyBatis Generator：重新生成映射文件
  - 若使用Flyway/Liquibase：创建数据库迁移脚本
  - 若手动管理：编写SQL脚本创建表
- **表结构**：
  ```sql
  CREATE TABLE coach_rating (
    rating_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    user_name VARCHAR(50) NOT NULL,
    coach_id BIGINT NOT NULL,
    rating INT NOT NULL CHECK (rating BETWEEN 1 AND 5),
    comment TEXT,
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES user(user_id),
    FOREIGN KEY (coach_id) REFERENCES coach(coach_id)
  );
  ```

### 2.2 前端实现

#### 2.2.1 创建评价组件
- **评价表单组件**：`CoachRatingForm.vue`
  - 包含星级评分和评价内容
  - 表单验证
  - 提交评价功能

- **评价列表组件**：`CoachRatingList.vue`
  - 展示教练平均评分
  - 展示评价列表
  - 包含评价发起人、时间、评分和内容

#### 2.2.2 修改现有组件

##### 2.2.2.1 UserCenter.vue
- 在教练名片的操作区添加“去评价”按钮
- 点击按钮弹出评价表单

##### 2.2.2.2 CoachList.vue
- 在教练名片的操作区添加“查看评价”按钮
- 点击按钮弹出评价列表

##### 2.2.2.3 CoachProfile.vue
- 在个人中心添加“我的评价”标签页
- 显示教练的综合评分和所有评价

### 2.3 数据流

1. **用户评价教练**：
   - 用户点击“去评价”按钮
   - 弹出评价表单
   - 用户填写评分和评价内容
   - 提交评价（调用API）
   - 更新教练的平均评分

2. **用户查看教练评价**：
   - 用户点击“查看评价”按钮
   - 弹出评价列表
   - 显示教练的平均评分和所有评价

3. **教练查看自己的评价**：
   - 教练进入个人中心
   - 点击“我的评价”标签页
   - 查看个人综合评分和所有评价

## 3. 技术细节

### 3.1 评价表单设计
- 使用Element Plus的`el-rate`组件实现星级评分
- 使用`el-input`组件实现评价内容输入
- 添加表单验证，确保评分和内容必填

### 3.2 评价列表设计
- 使用Element Plus的`el-table`组件展示评价
- 显示字段：发起人、时间、评分、内容
- 评分使用星级显示
- 顶部显示平均评分

### 3.3 评分计算
- 后端计算平均评分，存储在教练表中
- 前端显示实时更新

### 3.4 数据存储
- 评价数据存储在`coach_rating`表中
- 教练的平均评分存储在`coach`表的`rating`字段中

## 4. 实现步骤

### 4.1 后端实现
1. 创建`CoachRating`实体类
2. 创建`CoachRatingMapper`接口和XML
3. 创建`ICoachRatingService`接口和实现类
4. 创建`CoachRatingController`，添加API接口
5. 更新`CoachService`，添加获取平均评分的方法
6. **数据库同步**：根据项目现有配置，选择合适的方式创建表

### 4.2 前端实现
1. 创建`CoachRatingForm.vue`组件
2. 创建`CoachRatingList.vue`组件
3. 修改`UserCenter.vue`，添加“去评价”按钮和弹窗
4. 修改`CoachList.vue`，添加“查看评价”按钮和弹窗
5. 修改`CoachProfile.vue`，添加“我的评价”标签页
6. 实现评价提交和查看功能
7. 测试评价功能的完整流程

## 5. 预期效果

- 用户中心的教练名片显示“去评价”按钮
- 教练列表的名片显示“查看评价”按钮
- 教练个人中心显示“我的评价”标签页
- 评价表单包含星级评分和评价内容
- 评价列表显示发起人、时间、评分和内容
- 教练的平均评分实时更新

## 6. 注意事项

- 确保评价数据的安全性和完整性
- 防止恶意评价和刷分
- 提供合理的评价机制和规则
- 优化评价列表的性能，特别是对于评价较多的教练
- 确保数据库表结构正确创建和同步
- 与现有系统无缝集成

## 7. 优势

- 完善了教练评价体系，提高了平台的用户体验
- 帮助用户选择合适的教练
- 激励教练提高服务质量
- 增强了平台的互动性和可信度
- 实现了完整的评价流程，从提交到查看

## 8. 技术栈

- **后端**：Spring Boot, MyBatis, MySQL
- **前端**：Vue 3, Element Plus, Axios
- **状态管理**：Pinia

通过以上实现方案，可以完成教练评价功能的完整开发，满足用户需求，并确保系统的安全性和性能。